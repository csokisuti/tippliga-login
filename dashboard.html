<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="style-themed.css" />
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous" 
    src="https://connect.facebook.net/hu_HU/sdk.js#xfbml=1&version=v19.0" nonce="fb"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const app = initializeApp({/* konfig */});
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) return window.location.href = "login.html";

      const userRef = doc(db, "users", user.uid);
      const snap = await getDoc(userRef);
      if (!snap.exists()) return alert("Felhaszn√°l√≥i adatok nem tal√°lhat√≥k.");
      const { nickname = user.email, favoriteTeam = "" } = snap.data();

      document.getElementById("welcome").textContent = `√údv, ${nickname}!`;

      if (favoriteTeam) {
        const themeClass = "theme-" +
          favoriteTeam.toLowerCase().normalize("NFD")
            .replace(/[\u0300-\u036f]/g, '')
            .replace(/[^a-z0-9]+/g, '-');
        document.body.classList.add(themeClass);
        const logoImg = document.getElementById("teamLogo");
        logoImg.src = `crest/crest-${themeClass.replace("theme-","")}.png`;
        logoImg.alt = favoriteTeam;

        const feeds = document.querySelectorAll('.fb-feed');
        feeds.forEach(div => div.style.display = "none");

        const currentFeed = document.getElementById(`fb-${themeClass.replace("theme-", "")}`);
        if (currentFeed) {
          currentFeed.style.display = "block";
          if (window.FB) window.FB.XFBML.parse(currentFeed);
        }
      }

      const tableDoc = await getDoc(doc(db, "settings", "nbi_table_image"));
      if (tableDoc.exists()) {
        const img = document.createElement("img");
        img.src = `data:image/png;base64,${tableDoc.data().base64}`;
        img.style.maxWidth = "60%";
        document.getElementById("tableContainer").appendChild(img);
      }
    });

    document.getElementById("logoutButton").addEventListener("click", () => {
      signOut(auth).then(() => window.location.href = "login.html");
    });
  </script>
</head>
<body>
  <header>
    <h1>NB1 TippLiga</h1>
    <img id="teamLogo" style="height:40px; vertical-align: middle; margin-left:10px;">
  </header>
  <p id="welcome"></p>
  <nav>
    <a href="matches.html">Meccsek √©s tippek</a> |
    <a href="results.html">Eredm√©nyek</a> |
    <a href="leaderboard.html">√ñsszpontsz√°m</a> |
    <a href="positions.html">Szezon v√©gi sorrend</a> |
    <a href="profile.html">Profil</a> |
    <a id="adminLink" href="admin.html" style="display:none;">Admin fel√ºlet</a> |
    <button id="logoutButton">Kil√©p√©s</button>
  </nav>

  <div style="display:flex; gap:20px;">
    <div id="tableContainer"></div>
    <div id="newsContainer">
      <h2>üì£ Csapath√≠rek</h2>

      <div id="fb-debreceni-vsc" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/DVSCfoci/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-diosgyori-vtk" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/DVTKOfficial/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-ferencvaros" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/fradi.hu/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-eto-fc-gyor" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/EtoFCGyorOfficial/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-kazincbarcikai-sc" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/KazincbarcikaiSC/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-kisvarda-fc" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/Kisvardafc/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-mtk-budapest" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/mtkbudapestofficial/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-nyiregyhaza-spartacus" class="fb-feed" style="display: block;">
        <div class="fb-page" data-href="https://www.facebook.com/NYSFC/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-paksi-fc" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/PaksiFootballClub/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-puskas-akademia" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/puskasakademiafc/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-ujpest-fc" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/ujpestfcofficial/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>

      <div id="fb-zalaegerszegi-te-fc" class="fb-feed" style="display: none;">
        <div class="fb-page" data-href="https://www.facebook.com/ztefcofficial/" data-tabs="timeline" data-width="400" data-height="500" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"></div>
      </div>
    </div>
  </div>
</body>
</html>
