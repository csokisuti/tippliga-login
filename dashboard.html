<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Főoldal - Tippjáték</title>
  <link rel="stylesheet" href="style-themed.css" />
</head>
<body>
  <div id="mainContent">
    <h1>Üdvözöllek a Tippjátékban!</h1>
    <p id="welcomeMessage"></p>
    <img id="teamLogo" src="" alt="" style="height: 100px" />
    <div>
      <a href="matches.html">Meccsek és Tippek</a>
      <a href="results.html">Eredmények</a>
      <a href="points.html">Pontszámok</a>
      <a href="profile.html">Profilom</a>
      <button id="logout">Kilépés</button>
    </div>
    <div style="display: flex; gap: 40px; align-items: flex-start; margin-top: 20px;">
      <div id="tableContainer">
        <h2>NB1 Tabella</h2>
        <img id="leagueTableImage" src="" alt="NB1 Tabella" style="max-width: 100%; height: auto" />
      </div>
      <div id="fbFeedColumn">
        <h2>Csapat Facebook-hírfolyama</h2>
        <div id="fbFeedContent"></div>
      </div>
    </div>
  </div>

  <div id="fb-root"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2xpMW1xgaWIdI2Jo",
      authDomain: "tippliga.firebaseapp.com",
      projectId: "tippliga",
      storageBucket: "tippliga.appspot.com",
      messagingSenderId: "770336873136",
      appId: "1:770336873136:web:13e4e46cbff808fc8bd2a5",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    const teamNamesToClass = {
      "Debreceni VSC": "theme-debreceni-vsc",
      "Diósgyőri VTK": "theme-diosgyori-vtk",
      "Ferencváros": "theme-ferencvaros",
      "ETO FC Győr": "theme-eto-fc-gyor",
      "Kazincbarcikai SC": "theme-kazincbarcikai-sc",
      "Kisvárda FC": "theme-kisvarda-fc",
      "MTK Budapest": "theme-mtk-budapest",
      "Nyíregyháza Spartacus": "theme-nyiregyhaza-spartacus",
      "Paksi FC": "theme-paksi-fc",
      "Puskás Akadémia": "theme-puskas-akademia",
      "Újpest FC": "theme-ujpest-fc",
      "Zalaegerszegi TE FC": "theme-zalaegerszegi-te-fc",
    };

    const teamNamesToLogo = {
      "Debreceni VSC": "logos/debreceni-vsc.png",
      "Diósgyőri VTK": "logos/diosgyori-vtk.png",
      "Ferencváros": "logos/ferencvaros.png",
      "ETO FC Győr": "logos/eto-fc-gyor.png",
      "Kazincbarcikai SC": "logos/kazincbarcikai-sc.png",
      "Kisvárda FC": "logos/kisvarda-fc.png",
      "MTK Budapest": "logos/mtk-budapest.png",
      "Nyíregyháza Spartacus": "logos/nyiregyhaza-spartacus.png",
      "Paksi FC": "logos/paksi-fc.png",
      "Puskás Akadémia": "logos/puskas-akademia.png",
      "Újpest FC": "logos/ujpest-fc.png",
      "Zalaegerszegi TE FC": "logos/zalaegerszegi-te-fc.png",
    };

    const teamNamesToFbPage = {
      "Nyíregyháza Spartacus": "https://www.facebook.com/NYSFC/",
      "Debreceni VSC": "https://www.facebook.com/debrecenivsc/",
      "Diósgyőri VTK": "https://www.facebook.com/DVTK1910/",
      "Ferencváros": "https://www.facebook.com/fradi.hu/",
      "ETO FC Győr": "https://www.facebook.com/etofcgyor/",
      "Kazincbarcikai SC": "https://www.facebook.com/kazincbarcikaiSC/",
      "Kisvárda FC": "https://www.facebook.com/kisvardafc/",
      "MTK Budapest": "https://www.facebook.com/mtkbudapest/",
      "Paksi FC": "https://www.facebook.com/paksifcofficial/",
      "Puskás Akadémia": "https://www.facebook.com/puskasakademia/",
      "Újpest FC": "https://www.facebook.com/ujpestfc.hu/",
      "Zalaegerszegi TE FC": "https://www.facebook.com/ztefc/",
    };

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const docRef = doc(db, "users", user.uid);
        const docSnap = await getDoc(docRef);
        const userData = docSnap.data();
        const nickname = userData.nickname || user.email;
        const team = userData.favoriteTeam || "";
        document.getElementById("welcomeMessage").textContent = `Szia, ${nickname}!`;
        const className = teamNamesToClass[team];
        if (className) document.body.classList.add(className);
        const logoPath = teamNamesToLogo[team];
        if (logoPath) {
          document.getElementById("teamLogo").src = logoPath;
          document.getElementById("teamLogo").alt = team;
        }
        document.getElementById("leagueTableImage").src = "images/nb1-tabella.png";

        const fbPage = teamNamesToFbPage[team];
        if (fbPage) {
          const container = document.getElementById("fbFeedContent");
          container.innerHTML = `
            <div class="fb-page"
              data-href="${fbPage}"
              data-tabs="timeline"
              data-width="400"
              data-height="600"
              data-small-header="false"
              data-adapt-container-width="true"
              data-hide-cover="false"
              data-show-facepile="true">
              <blockquote cite="${fbPage}" class="fb-xfbml-parse-ignore">
                <a href="${fbPage}">${team}</a>
              </blockquote>
            </div>
          `;
          if (!document.getElementById("fb-sdk")) {
            const fbScript = document.createElement("script");
            fbScript.id = "fb-sdk";
            fbScript.src = "https://connect.facebook.net/hu_HU/sdk.js#xfbml=1&version=v19.0";
            fbScript.async = true;
            fbScript.defer = true;
            fbScript.onload = () => {
              if (window.FB) window.FB.XFBML.parse();
            };
            document.body.appendChild(fbScript);
          } else {
            if (window.FB) window.FB.XFBML.parse();
          }
        }
      } else {
        window.location.href = "login.html";
      }
    });

    document.getElementById("logout").addEventListener("click", () => {
      signOut(auth).then(() => {
        window.location.href = "login.html";
      });
    });
  </script>
</body>
</html>
