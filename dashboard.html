<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="style-themed.css">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script async defer crossorigin="anonymous" 
    src="https://connect.facebook.net/hu_HU/sdk.js#xfbml=1&version=v19.0">
  </script>
</head>
<body>
  <header>
    <h1>Üdvözöllek a Tippjátékban!</h1>
    <button onclick="logout()">Kilépés</button>
  </header>

  <main>
    <div class="content-container">
      <div class="left-column">
        <h2>NB I tabella</h2>
        <div id="tableImageContainer"></div>
      </div>
      <div class="right-column">
        <div id="teamLogoSection"></div>
        <h2>Kedvenc csapatod hírfolyama</h2>
        <div id="facebookFeedContainer"></div>
      </div>
    </div>
  </main>

  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyC2xpMW1xgaWIdI2JoEhK23vkC0FTF2PKc",
  authDomain: "tippliga-4b3af.firebaseapp.com",
  projectId: "tippliga-4b3af",
  storageBucket: "tippliga-4b3af.firebasestorage.app",
  messagingSenderId: "720359845241",
  appId: "1:720359845241:web:d3d6edcac6b43ebff053a8"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const teamData = {
      "Debreceni VSC": {
        crest: "crest/crest-dvsc.png",
        facebook: "https://www.facebook.com/dvscfoci/"
      },
      "Diósgyőri VTK": {
        crest: "crest/crest-dvtk.png",
        facebook: "https://www.facebook.com/DVTKOfficial/"
      },
      "Ferencváros": {
        crest: "crest/crest-fradi.png",
        facebook: "https://www.facebook.com/fradi.hu/"
      },
      "ETO FC Győr": {
        crest: "crest/crest-gyor.png",
        facebook: "https://www.facebook.com/EtoFCGyorOfficial/"
      },
      "Kazincbarcikai SC": {
        crest: "crest/crest-kazincbarcika.png",
        facebook: "https://www.facebook.com/KazincbarcikaiSC/"
      },
      "Kisvárda FC": {
        crest: "crest/crest-kisvarda.png",
        facebook: "https://www.facebook.com/Kisvardafc/"
      },
      "MTK Budapest": {
        crest: "crest/crest-mtk.png",
        facebook: "https://www.facebook.com/mtkbudapestofficial/"
      },
      "Nyíregyháza Spartacus": {
        crest: "crest/crest-nyiregyhaza.png",
        facebook: "https://www.facebook.com/NYSFC/"
      },
      "Paksi FC": {
        crest: "crest/crest-paks.png",
        facebook: "https://www.facebook.com/PaksiFootballClub/"
      },
      "Puskás Akadémia": {
        crest: "crest/crest-puskas.png",
        facebook: "https://www.facebook.com/puskasakademiafc/"
      },
      "Újpest FC": {
        crest: "crest/crest-ujpest.png",
        facebook: "https://www.facebook.com/ujpestfcofficial/"
      },
      "Zalaegerszegi TE FC": {
        crest: "crest/crest-zte.png",
        facebook: "https://www.facebook.com/ztefc.hu/"
      }
    };

    auth.onAuthStateChanged(async user => {
      if (user) {
        const userDoc = await db.collection("users").doc(user.uid).get();
        const userData = userDoc.data();
        const favTeam = userData.favourite_team;

        const team = teamData[favTeam];
        if (team) {
          document.getElementById("teamLogoSection").innerHTML =
            `<img src="${team.crest}" alt="${favTeam} logo" class="team-logo">`;

          const fbContainer = document.getElementById("facebookFeedContainer");
          fbContainer.innerHTML = `
            <div class="fb-page"
                 data-href="${team.facebook}"
                 data-tabs="timeline"
                 data-width="500"
                 data-small-header="false"
                 data-adapt-container-width="true"
                 data-hide-cover="false"
                 data-show-facepile="true">
            </div>`;
          if (typeof FB !== "undefined") FB.XFBML.parse(fbContainer);
        } else {
          document.getElementById("facebookFeedContainer").textContent =
            "Nem található Facebook-hírfolyam ehhez a csapathoz.";
        }

        if (userData.tableImage) {
          document.getElementById("tableImageContainer").innerHTML =
            `<img src="${userData.tableImage}" alt="NB I tabella" class="table-image">`;
        }
      } else {
        window.location.href = "login.html";
      }
    });

    function logout() {
      auth.signOut().then(() => {
        window.location.href = "login.html";
      });
    }
  </script>
</body>
</html>
