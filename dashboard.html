<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - UEFA BL</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      collection,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2xpMW1xgaWIdI2JoEhK23vkC0FTF2PKc",
      authDomain: "tippliga-4b3af.firebaseapp.com",
      projectId: "tippliga-4b3af",
      storageBucket: "tippliga-4b3af.appspot.com",
      messagingSenderId: "720359845241",
      appId: "1:720359845241:web:d3d6edcac6b43ebff053a8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const email = user.email;
      let nickname = email;
      let role = "user";

      const usersSnapshot = await getDocs(collection(db, "users"));
      usersSnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        if (data.email === email) {
          nickname = data.nickname;
          role = data.role || "user";
        }
      });

      document.getElementById("welcome").textContent = `√údv, ${nickname}!`;
      if (role === "admin") {
        document.getElementById("adminLink").style.display = "inline";
      }

      const token = "5c177bbe629d4313af1c2899ee241309";
      fetch("https://api.football-data.org/v4/competitions/CL/standings", {
        headers: {
          "X-Auth-Token": token
        }
      })
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("tableContainer");

          data.standings.forEach(group => {
            const groupTitle = document.createElement("h3");
            groupTitle.textContent = group.group;
            container.appendChild(groupTitle);

            const table = document.createElement("table");
            table.style.width = "100%";
            table.style.borderCollapse = "collapse";
            table.style.marginBottom = "20px";
            table.innerHTML = `
              <thead>
                <tr>
                  <th>#</th>
                  <th>Csapat</th>
                  <th>M</th>
                  <th>Gy</th>
                  <th>D</th>
                  <th>V</th>
                  <th>RG</th>
                  <th>KG</th>
                  <th>GK</th>
                  <th>Pont</th>
                </tr>
              </thead>
              <tbody></tbody>
            `;

            const tbody = table.querySelector("tbody");
            group.table.forEach(team => {
              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${team.position}</td>
                <td style="text-align:left;">
                  <img src="${team.team.crest}" alt="" width="20" style="vertical-align:middle; margin-right:6px;">
                  ${team.team.name}
                </td>
                <td>${team.playedGames}</td>
                <td>${team.won}</td>
                <td>${team.draw}</td>
                <td>${team.lost}</td>
                <td>${team.goalsFor}</td>
                <td>${team.goalsAgainst}</td>
                <td>${team.goalDifference}</td>
                <td>${team.points}</td>
              `;
              tbody.appendChild(row);
            });

            container.appendChild(table);
          });
        })
        .catch(err => {
          console.error("BL tabella bet√∂lt√©si hiba:", err);
          document.getElementById("tableContainer").textContent = "Nem siker√ºlt bet√∂lteni a Bajnokok Lig√°ja tabell√°t.";
        });
    });

    document.getElementById("logout").addEventListener("click", () => {
      signOut(auth).then(() => {
        window.location.href = "login.html";
      });
    });
  </script>
</head>
<body>
  <h1>NB1 TippLiga / UEFA BL</h1>
  <p id="welcome"></p>
  <nav>
    <a href="matches.html">üîÆ Meccsek √©s tippek</a> |
    <a href="results.html">üìã Eredm√©nyek</a> |
    <a href="leaderboard.html">üèÜ √ñsszpontsz√°m</a> |
    <a href="positions.html">üìä Szezon v√©gi sorrend</a> |
    <a href="admin.html" id="adminLink" style="display:none;">‚öôÔ∏è Admin fel√ºlet</a> |
    <button id="logout">Kil√©p√©s</button>
  </nav>
  <div id="tableContainer" style="margin-top: 30px;"></div>
</body>
</html>
