
<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>NB1 TippLiga</title>
  <link rel="stylesheet" href="style-themed.css" />
  <style>
    .dashboard-container {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 20px;
    }
    .dashboard-table, .dashboard-feed {
      flex: 1;
      min-width: 300px;
    }
    .team-logo {
      max-height: 100px;
      margin: 10px auto;
      display: block;
    }
    .league-table-img {
      max-width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <header>
    <h1>NB1 TippLiga</h1>
    <nav>
      <a href="matches.html">Meccsek és tippek</a> |
      <a href="results.html">Eredmények</a> |
      <a href="standings.html">Összpontszám</a> |
      <a href="positions.html">Szezon végi sorrend</a> |
      <a href="profile.html">Profil</a> |
      <button id="logoutButton">Kilépés</button>
    </nav>
  </header>

  <main>
    <section id="teamLogoSection"></section>
    <section class="dashboard-container">
      <div class="dashboard-table">
        <h2>NB1 Tabella</h2>
        <img src="nb1-tabella.png" alt="NB1 Tabella" class="league-table-img">
      </div>
      <div class="dashboard-feed">
        <h2>Hírek a kedvenc csapatodtól</h2>
        <div id="facebookFeedContainer"></div>
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2xpMW1xgaWIdI2JoEhK23vkC0FTF2PKc",
      authDomain: "tippliga-4b3af.firebaseapp.com",
      projectId: "tippliga-4b3af",
      storageBucket: "tippliga-4b3af.appspot.com",
      messagingSenderId: "720359845241",
      appId: "1:720359845241:web:d3d6edcac6b43ebff053a8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const logoutButton = document.getElementById('logoutButton');
    logoutButton.addEventListener('click', () => {
      signOut(auth).then(() => {
        window.location.href = "login.html";
      });
    });

    const facebookPages = {
      "Debreceni VSC": "dvsc1962",
      "Diósgyőri VTK": "diosgyorivtk",
      "Ferencváros": "fradi.hu",
      "ETO FC Győr": "etofcgyor",
      "Kazincbarcikai SC": "kbsc.hu",
      "Kisvárda FC": "kisvardafc",
      "MTK Budapest": "mtkbudapest",
      "Nyíregyháza Spartacus": "NYSFC",
      "Paksi FC": "paksifcofficial",
      "Puskás Akadémia": "puskasakademia",
      "Újpest FC": "ujpestfc",
      "Zalaegerszegi TE FC": "ztefc"
    };

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const userRef = doc(db, "users", user.uid);
        const userSnap = await getDoc(userRef);
        if (userSnap.exists()) {
          const data = userSnap.data();
          const favTeam = data.favoriteTeam;
          const logoPath = `logos/${favTeam}.png`;
          document.getElementById("teamLogoSection").innerHTML =
            `<img src="${logoPath}" alt="${favTeam} logo" class="team-logo">`;

          const pageName = facebookPages[favTeam];
          const container = document.getElementById("facebookFeedContainer");
          if (pageName && container) {
            container.innerHTML = `
              <div class="fb-page" 
                data-href="https://www.facebook.com/${pageName}" 
                data-tabs="timeline" 
                data-width="500" 
                data-height="" 
                data-small-header="false" 
                data-adapt-container-width="true" 
                data-hide-cover="false" 
                data-show-facepile="true">
              </div>`;
            if (typeof FB !== "undefined") {
              FB.XFBML.parse(container);
            }
          }
        }
      } else {
        window.location.href = "login.html";
      }
    });
  </script>

  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/hu_HU/sdk.js#xfbml=1&version=v19.0">
  </script>
</body>
</html>
