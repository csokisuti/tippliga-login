<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      collection,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2xpMW1xgaWIdI2JoEhK23vkC0FTF2PKc",
      authDomain: "tippliga-4b3af.firebaseapp.com",
      projectId: "tippliga-4b3af",
      storageBucket: "tippliga-4b3af.appspot.com",
      messagingSenderId: "720359845241",
      appId: "1:720359845241:web:d3d6edcac6b43ebff053a8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const email = user.email;
      let nickname = email;
      let role = "user";

      const usersSnapshot = await getDocs(collection(db, "users"));
      usersSnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        if (data.email === email) {
          nickname = data.nickname;
          role = data.role || "user";
        }
      });

      document.getElementById("welcome").textContent = `Üdv, ${nickname}!`;
      if (role === "admin") {
        document.getElementById("adminLink").style.display = "inline";
      }

      // NB1 tabella betöltése TheSportsDB API-ból
      const apiKey = "123"; // <-- IDE ÍRD A SAJÁT API KULCSODAT
      const apiUrl = `https://www.thesportsdb.com/api/v1/json/${apiKey}/lookuptable.php?l=4690&s=2025-2026`;

      fetch(apiUrl)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("tableContainer");
          const table = document.createElement("table");
          table.style.width = "100%";
          table.style.borderCollapse = "collapse";
          table.style.marginTop = "20px";
          table.innerHTML = `
            <thead>
              <tr>
                <th>#</th>
                <th>Csapat</th>
                <th>M</th>
                <th>Gy</th>
                <th>D</th>
                <th>V</th>
                <th>RG</th>
                <th>KG</th>
                <th>Pont</th>
              </tr>
            </thead>
            <tbody></tbody>
          `;

          const tbody = table.querySelector("tbody");

          data.table.forEach((team, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${index + 1}</td>
              <td style="text-align:left;">${team.
