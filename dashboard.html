<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      collection,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2xpMW1xgaWIdI2JoEhK23vkC0FTF2PKc",
      authDomain: "tippliga-4b3af.firebaseapp.com",
      projectId: "tippliga-4b3af",
      storageBucket: "tippliga-4b3af.appspot.com",
      messagingSenderId: "720359845241",
      appId: "1:720359845241:web:d3d6edcac6b43ebff053a8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const email = user.email;
      let nickname = email;
      let role = "user";

      const usersSnapshot = await getDocs(collection(db, "users"));
      usersSnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        if (data.email === email) {
          nickname = data.nickname;
          role = data.role || "user";
        }
      });

      document.getElementById("welcome").textContent = `√údv, ${nickname}!`;
      if (role === "admin") {
        document.getElementById("adminLink").style.display = "inline";
      }

      // NB1 tabella bet√∂lt√©se TheSportsDB API-b√≥l
      const apiKey = "134"; // <-- IDE √çRD A SAJ√ÅT API KULCSODAT
      const apiUrl = `https://www.thesportsdb.com/api/v1/json/${apiKey}/lookuptable.php?l=4690&s=2025-2026`;

      fetch(apiUrl)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("tableContainer");
          const table = document.createElement("table");
          table.style.width = "100%";
          table.style.borderCollapse = "collapse";
          table.style.marginTop = "20px";
          table.innerHTML = `
            <thead>
              <tr>
                <th>#</th>
                <th>Csapat</th>
                <th>M</th>
                <th>Gy</th>
                <th>D</th>
                <th>V</th>
                <th>RG</th>
                <th>KG</th>
                <th>Pont</th>
              </tr>
            </thead>
            <tbody></tbody>
          `;

          const tbody = table.querySelector("tbody");

          data.table.forEach((team, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${index + 1}</td>
              <td style="text-align:left;">${team.name}</td>
              <td>${team.played}</td>
              <td>${team.win}</td>
              <td>${team.draw}</td>
              <td>${team.loss}</td>
              <td>${team.goalsfor}</td>
              <td>${team.goalsagainst}</td>
              <td>${team.total}</td>
            `;
            tbody.appendChild(row);
          });

          container.appendChild(table);
        })
        .catch(err => {
          document.getElementById("tableContainer").textContent = "Nem siker√ºlt bet√∂lteni a tabell√°t.";
          console.error("Tabella hiba:", err);
        });
    });

    document.getElementById("logout").addEventListener("click", () => {
      signOut(auth).then(() => {
        window.location.href = "login.html";
      });
    });
  </script>
</head>
<body>
  <h1>NB1 TippLiga</h1>
  <p id="welcome"></p>
  <nav>
    <a href="matches.html">üîÆ Meccsek √©s tippek</a> |
    <a href="results.html">üìã Eredm√©nyek</a> |
    <a href="leaderboard.html">üèÜ √ñsszpontsz√°m</a> |
    <a href="positions.html">üìä Szezon v√©gi sorrend</a> |
    <a href="admin.html" id="adminLink" style="display:none;">‚öôÔ∏è Admin fel√ºlet</a> |
    <button id="logout">Kil√©p√©s</button>
  </nav>
  <div id="tableContainer"></div>
</body>
</html>
