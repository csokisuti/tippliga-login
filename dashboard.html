<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="style-themed.css" />
</head>
<body>
  <div id="dashboard-container">
    <h2 id="welcome"></h2>
    <img id="team-logo" alt="Kedvenc csapat log√≥ja" style="height: 80px; margin-bottom: 20px;" />

    <div id="menu">
      <a href="matches.html">‚öΩ Meccsek √©s tippek</a>
      <a href="results.html">üìä Kor√°bbi meccsek</a>
      <a href="leaderboard.html">üèÜ √ñsszes√≠tett pontsz√°m</a>
      <a href="profile.html">üë§ Profil</a>
      <a href="admin.html" id="admin-link" style="display: none;">üõ†Ô∏è Admin</a>
    </div>

    <div id="main-content">
      <div id="table-and-feed">
        <div id="nb1-table-container"></div>
        <div id="fb-feed-container"></div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2xpMW1xgaWIdI2Jo-9OYO_BMM05Tb4DE",
      authDomain: "tippliga.firebaseapp.com",
      projectId: "tippliga",
      storageBucket: "tippliga.appspot.com",
      messagingSenderId: "86994673654",
      appId: "1:86994673654:web:6a4b60381d40365d44c5b6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const crestMap = {
      "Debreceni VSC": "dvsc",
      "Di√≥sgy≈ëri VTK": "dvtk",
      "Ferencv√°ros": "fradi",
      "ETO FC Gy≈ër": "gyor",
      "Kazincbarcikai SC": "kazincbarcika",
      "Kisv√°rda FC": "kisvarda",
      "MTK Budapest": "mtk",
      "Ny√≠regyh√°za Spartacus": "nyiregyhaza",
      "Paksi FC": "paks",
      "Pusk√°s Akad√©mia": "puskas",
      "√öjpest FC": "ujpest",
      "Zalaegerszegi TE FC": "zte"
    };

    const facebookPages = {
      "Debreceni VSC": "https://www.facebook.com/debrecenidvsc",
      "Di√≥sgy≈ëri VTK": "https://www.facebook.com/dvtk1910",
      "Ferencv√°ros": "https://www.facebook.com/fradi.hu",
      "ETO FC Gy≈ër": "https://www.facebook.com/etofcgyor",
      "Kazincbarcikai SC": "https://www.facebook.com/kazincbarcikaiSC",
      "Kisv√°rda FC": "https://www.facebook.com/kisvardafc",
      "MTK Budapest": "https://www.facebook.com/MTKBudapestLabdarugoZrt",
      "Ny√≠regyh√°za Spartacus": "https://www.facebook.com/szparifc",
      "Paksi FC": "https://www.facebook.com/paksifcofficial",
      "Pusk√°s Akad√©mia": "https://www.facebook.com/puskasakademia",
      "√öjpest FC": "https://www.facebook.com/ujpestfc",
      "Zalaegerszegi TE FC": "https://www.facebook.com/ztefc"
    };

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const userDoc = await getDoc(doc(db, "users", user.uid));
        if (userDoc.exists()) {
          const userData = userDoc.data();
          const nickname = userData.nickname || "Felhaszn√°l√≥";
          const favoriteTeam = userData.favoriteTeam || null;
          const role = userData.role || "";

          document.getElementById("welcome").innerText = `√údv√∂zl√ºnk, ${nickname}!`;

          if (role === "admin") {
            document.getElementById("admin-link").style.display = "inline-block";
          }

          if (favoriteTeam && crestMap[favoriteTeam]) {
            const logoPath = `crest/crest-${crestMap[favoriteTeam]}.png`;
            document.getElementById("team-logo").src = logoPath;
          }

          if (favoriteTeam && facebookPages[favoriteTeam]) {
            const fbUrl = facebookPages[favoriteTeam];
            const iframe = document.createElement("iframe");
            iframe.src = `https://www.facebook.com/plugins/page.php?href=${encodeURIComponent(fbUrl)}&tabs=timeline&width=500&height=600&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true`;
            iframe.width = "500";
            iframe.height = "600";
            iframe.style.border = "none";
            iframe.style.overflow = "hidden";
            iframe.scrolling = "no";
            iframe.frameBorder = "0";
            iframe.allow = "autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share";
            iframe.allowFullscreen = true;
            document.getElementById("fb-feed-container").appendChild(iframe);
          }

          const tableDoc = await getDoc(doc(db, "config", "nb1Table"));
          if (tableDoc.exists()) {
            const tableData = tableDoc.data();
            if (tableData.image) {
              const img = document.createElement("img");
              img.src = tableData.image;
              img.alt = "NB1 tabella";
              img.style.maxWidth = "100%";
              document.getElementById("nb1-table-container").appendChild(img);
            } else {
              document.getElementById("nb1-table-container").innerText = "Nincs el√©rhet≈ë NB1 tabella.";
            }
          } else {
            document.getElementById("nb1-table-container").innerText = "NB1 tabella nem tal√°lhat√≥.";
          }

        } else {
          window.location.href = "login.html";
        }
      } else {
        window.location.href = "login.html";
      }
    });
  </script>
</body>
</html>
