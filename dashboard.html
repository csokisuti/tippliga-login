<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MSG_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const teamFacebookPages = {
      "Debreceni VSC": "https://www.facebook.com/DVSCFOFFICIAL/",
      "Di√≥sgy≈ëri VTK": "https://www.facebook.com/1910DVTK/",
      "Ferencv√°ros": "https://www.facebook.com/fradi.hu/",
      "ETO FC Gy≈ër": "https://www.facebook.com/etofcgyor/",
      "Kazincbarcikai SC": "https://www.facebook.com/KazincbarcikaiSC/",
      "Kisv√°rda FC": "https://www.facebook.com/kisvardafc/",
      "MTK Budapest": "https://www.facebook.com/mtkbudapest/",
      "Ny√≠regyh√°za Spartacus": "https://www.facebook.com/NYSFC/",
      "Paksi FC": "https://www.facebook.com/paksifcofficial/",
      "Pusk√°s Akad√©mia": "https://www.facebook.com/puskasakademia/",
      "√öjpest FC": "https://www.facebook.com/ujpestfootballclub/",
      "Zalaegerszegi TE FC": "https://www.facebook.com/ztefc/"
    };

    const teamLogoMap = {
      "Debreceni VSC": "crest-dvsc.png",
      "Di√≥sgy≈ëri VTK": "crest-dvtk.png",
      "Ferencv√°ros": "crest-fradi.png",
      "ETO FC Gy≈ër": "crest-gyor.png",
      "Kazincbarcikai SC": "crest-kazincbarcika.png",
      "Kisv√°rda FC": "crest-kisvarda.png",
      "MTK Budapest": "crest-mtk.png",
      "Ny√≠regyh√°za Spartacus": "crest-nyiregyhaza.png",
      "Paksi FC": "crest-paks.png",
      "Pusk√°s Akad√©mia": "crest-puskas.png",
      "√öjpest FC": "crest-ujpest.png",
      "Zalaegerszegi TE FC": "crest-zte.png"
    };

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const uid = user.uid;
        const userDoc = await getDoc(doc(db, "users", uid));
        if (userDoc.exists()) {
          const data = userDoc.data();
          document.getElementById("nickname").textContent = data.nickname || "";
          const team = data.favoriteTeam;

          // Log√≥ megjelen√≠t√©se
          const logoPath = teamLogoMap[team];
          if (logoPath) {
            const logoImg = document.getElementById("teamLogo");
            logoImg.src = `crest/${logoPath}`;
            logoImg.alt = `${team} log√≥`;
            logoImg.style.display = "inline-block";
          }

          // Facebook feed megjelen√≠t√©se
          const pageUrl = teamFacebookPages[team];
          if (pageUrl) {
            const feedDiv = document.getElementById("facebookFeedContainer");
            feedDiv.innerHTML = `
              <h2>üì£ ${team} h√≠rek a Facebookr√≥l</h2>
              <div class="fb-page"
                   data-href="${pageUrl}"
                   data-tabs="timeline"
                   data-width="500"
                   data-height=""
                   data-small-header="false"
                   data-adapt-container-width="true"
                   data-hide-cover="false"
                   data-show-facepile="true">
                <blockquote cite="${pageUrl}" class="fb-xfbml-parse-ignore">
                  <a href="${pageUrl}">${team}</a>
                </blockquote>
              </div>
            `;

            if (!document.getElementById("fb-sdk")) {
              const fbScript = document.createElement("script");
              fbScript.id = "fb-sdk";
              fbScript.async = true;
              fbScript.defer = true;
              fbScript.crossOrigin = "anonymous";
              fbScript.src = "https://connect.facebook.net/hu_HU/sdk.js#xfbml=1&version=v19.0";
              document.body.appendChild(fbScript);
            } else {
              if (window.FB) window.FB.XFBML.parse();
            }
          }
        }
      } else {
        window.location.href = "login.html";
      }
    });

    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("logout").addEventListener("click", () => {
        signOut(auth).then(() => {
          window.location.href = "login.html";
        });
      });
    });
  </script>
</head>
<body>
  <header>
    <h1>Focis Tippj√°t√©k Dashboard</h1>
    <p>√údv√∂z√∂llek, <span id="nickname"></span>!</p>
    <img id="teamLogo" src="" alt="Kedvenc csapat log√≥ja" width="80" style="display:none; margin: 10px 0;" />
    <button id="logout">Kil√©p√©s</button>
    <nav>
      <a href="matches.html">Meccsek √©s Tippel√©s</a> |
      <a href="results.html">Kor√°bbi Tippek</a> |
      <a href="standings.html">Tabella</a> |
      <a href="profile.html">Profil</a>
    </nav>
  </header>

  <main style="display: flex; flex-direction: row; gap: 20px; align-items: flex-start;">
    <div style="flex: 1;">
      <h2>‚öΩ NB1 Tabella</h2>
      <img src="nb1-table.png" alt="NB1 Tabella" style="max-width:100%;" />
    </div>
    <div id="facebookFeedContainer" style="flex: 1;"></div>
  </main>
</body>
</html>
