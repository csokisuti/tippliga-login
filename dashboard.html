<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard</title>
  <link rel="stylesheet" href="style-themed.css" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      collection,
      query,
      where,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyC2xpMW1xgaWIdI2JoEhK23vkC0FTF2PKc",
  authDomain: "tippliga-4b3af.firebaseapp.com",
  projectId: "tippliga-4b3af",
  storageBucket: "tippliga-4b3af.firebasestorage.app",
  messagingSenderId: "720359845241",
  appId: "1:720359845241:web:d3d6edcac6b43ebff053a8"
};
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const teamLogoMap = {
      "Debreceni VSC": "crest/crest-dvsc.png",
      "Diósgyőri VTK": "crest/crest-dvtk.png",
      "Ferencváros": "crest/crest-fradi.png",
      "ETO FC Győr": "crest/crest-gyor.png",
      "Kazincbarcikai SC": "crest/crest-kazincbarcika.png",
      "Kisvárda FC": "crest/crest-kisvarda.png",
      "MTK Budapest": "crest/crest-mtk.png",
      "Nyíregyháza Spartacus": "crest/crest-nyiregyhaza.png",
      "Paksi FC": "crest/crest-paks.png",
      "Puskás Akadémia": "crest/crest-puskas.png",
      "Újpest FC": "crest/crest-ujpest.png",
      "Zalaegerszegi TE FC": "crest/crest-zte.png"
    };

    const teamFacebookPages = {
      "Debreceni VSC": "https://www.facebook.com/DVSCFOFFICIAL",
      "Diósgyőri VTK": "https://www.facebook.com/DVTK1910",
      "Ferencváros": "https://www.facebook.com/fradi.hu",
      "ETO FC Győr": "https://www.facebook.com/etofcgyor",
      "Kazincbarcikai SC": "https://www.facebook.com/KazincbarcikaiSC",
      "Kisvárda FC": "https://www.facebook.com/kisvardafc",
      "MTK Budapest": "https://www.facebook.com/mtkbudapest",
      "Nyíregyháza Spartacus": "https://www.facebook.com/NYSFC",
      "Paksi FC": "https://www.facebook.com/paksifcofficial",
      "Puskás Akadémia": "https://www.facebook.com/puskasakademia",
      "Újpest FC": "https://www.facebook.com/ujpestfc",
      "Zalaegerszegi TE FC": "https://www.facebook.com/ztefc"
    };

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const email = user.email;
        const usersRef = collection(db, "users");
        const q = query(usersRef, where("email", "==", email));
        const querySnapshot = await getDocs(q);

        if (!querySnapshot.empty) {
          const userData = querySnapshot.docs[0].data();
          const nickname = userData.nickname || "";
          const favoriteTeam = userData.favoriteTeam || "";

          document.getElementById("welcomeUser").textContent = `Üdvözöllek, ${nickname}!`;

          const logoPath = teamLogoMap[favoriteTeam];
          if (logoPath) {
            document.getElementById("teamLogo").src = logoPath;
            document.getElementById("teamLogo").alt = favoriteTeam;
            document.getElementById("teamLogo").style.display = "inline-block";
          }

          const fbPage = teamFacebookPages[favoriteTeam];
          if (fbPage) {
            const iframe = document.createElement("iframe");
            iframe.src = `https://www.facebook.com/plugins/page.php?href=${encodeURIComponent(fbPage)}&tabs=timeline&width=500&height=600&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId`;
            iframe.width = "500";
            iframe.height = "600";
            iframe.style.border = "none";
            iframe.style.overflow = "hidden";
            iframe.scrolling = "no";
            iframe.frameBorder = "0";
            iframe.allowFullscreen = true;
            iframe.allow = "autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share";
            document.getElementById("facebookFeedContainer").appendChild(iframe);
          }
        } else {
          document.getElementById("welcomeUser").textContent = "Felhasználó nem található.";
        }
      } else {
        window.location.href = "login.html";
      }
    });

    document.getElementById("logoutButton").addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "login.html";
    });
  </script>
</head>
<body>
  <div class="dashboard-header">
    <h1 id="welcomeUser">Betöltés...</h1>
    <img id="teamLogo" src="" alt="" style="display:none; height: 50px; vertical-align: middle;" />
    <button id="logoutButton">Kilépés</button>
  </div>

  <div class="dashboard-content">
    <div class="dashboard-left">
      <img src="tabella.png" alt="NB1 Tabella" style="width: 100%; max-width: 500px;" />
    </div>
    <div class="dashboard-right">
      <div id="facebookFeedContainer"></div>
    </div>
  </div>
</body>
</html>
