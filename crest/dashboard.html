
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>NB1 TippLiga Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC2xpMW1xgaWIdI2JoPQwEnFoQsnA6TgOg",
            authDomain: "tippliga-login.firebaseapp.com",
            projectId: "tippliga-login",
            storageBucket: "tippliga-login.appspot.com",
            messagingSenderId: "444470792674",
            appId: "1:444470792674:web:6f4a437ba6a9c1fce2f9ee"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);

        const facebookPages = {
            "Debreceni VSC": "dvscfoci",
            "Diósgyőri VTK": "DVTK1910",
            "Ferencváros": "fradi.hu",
            "ETO FC Győr": "etofcgyor",
            "Kazincbarcikai SC": "kbscfoci",
            "Kisvárda FC": "kisvardafc",
            "MTK Budapest": "mtkbudapest",
            "Nyíregyháza Spartacus": "szparifc",
            "Paksi FC": "paksifcofficial",
            "Puskás Akadémia": "puskasakademia",
            "Újpest FC": "ujpestfootballclub",
            "Zalaegerszegi TE FC": "ztefc"
        };

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = "login.html";
                return;
            }

            const uid = user.uid;
            const userDoc = await getDoc(doc(db, "users", uid));

            if (userDoc.exists()) {
                const data = userDoc.data();
                const nickname = data.nickname || "Játékos";
                const team = data.favoriteTeam || "Debreceni VSC";

                document.getElementById("welcome").innerText = `Üdvözöllek, ${nickname}!`;

                const crestName = team.toLowerCase().replace(/ /g, "")
                    .replace("fc", "").replace("zte", "zte").replace("újpest", "ujpest")
                    .replace("puskás", "puskas").replace("győr", "gyor")
                    .replace("diósgyőri", "dvtk").replace("debreceni", "dvsc")
                    .replace("nyíregyháza", "nyiregyhaza")
                    .replace("kazincbarcikai", "kazincbarcika")
                    .replace("kisvárda", "kisvarda").replace("mtk", "mtk");

                document.getElementById("team-logo").src = `crest/crest-${crestName}.png`;
                document.getElementById("team-logo").alt = team + " logo";

                const fbPageId = facebookPages[team];
                const feedContainer = document.getElementById("fb-feed");

                if (fbPageId) {
                    const iframe = document.createElement("iframe");
                    iframe.src = `https://www.facebook.com/plugins/page.php?href=https://www.facebook.com/${fbPageId}&tabs=timeline&width=500&height=500&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId`;
                    iframe.width = "500";
                    iframe.height = "500";
                    iframe.style.border = "none";
                    iframe.style.overflow = "hidden";
                    iframe.scrolling = "no";
                    iframe.frameBorder = "0";
                    iframe.allow = "encrypted-media";
                    feedContainer.appendChild(iframe);
                } else {
                    feedContainer.innerText = "Nem található Facebook-hírfolyam ehhez a csapathoz.";
                }
            }
        });

        function logout() {
            signOut(auth).then(() => window.location.href = "login.html");
        }
    </script>
</head>
<body>
    <h1 id="welcome">Üdvözöllek a Tippjátékban!</h1>
    <button onclick="logout()">Kilépés</button>

    <h2>NB I tabella</h2>
    <img src="tabella.png" alt="NB I Tabella" width="800">

    <h2>Kedvenc csapatod hírfolyama</h2>
    <img id="team-logo" src="" alt="Kedvenc csapat logója" height="80"><br><br>
    <div id="fb-feed">Betöltés...</div>
</body>
</html>
