<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Bejelentkezés / Regisztráció</title>
  <link rel="stylesheet" href="style.css">
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--text:#0f172a;--muted:#64748b;--line:#e6eaf1;--accent:#3b82f6}
    body{background:var(--bg);color:var(--text);margin:0}
    .page{max-width:980px;margin:32px auto;padding:0 16px;display:flex;flex-direction:column;gap:16px}
    .login-container{background:var(--card);border:1px solid var(--line);border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,.06);padding:18px}
    .login-container h3{margin:6px 0 12px}
    .login-container input{width:100%;height:40px;border:1px solid var(--line);border-radius:10px;padding:8px 10px;box-sizing:border-box;margin:6px 0}
    .login-actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{min-height:40px;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn-primary{background:var(--accent);color:#fff;border:1px solid var(--line);box-shadow:0 6px 18px rgba(0,0,0,.08)}
    .btn-ghost{background:#fff;color:#111;border:1px solid var(--line)}
    .btn[disabled]{opacity:.55;cursor:not-allowed;filter:grayscale(.25)}

    /* Notice */
    .notice{display:none;padding:10px 12px;border-radius:10px;border:1px solid var(--line);margin:0 0 10px}
    .notice.show{display:block}
    .notice.success{background:#ecfdf5;border-color:#a7f3d0;color:#065f46}
    .notice.error{background:#fef2f2;border-color:#fecaca;color:#7f1d1d}

    /* Liga választó (NB1 dashboard-koherens) */
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,.06);overflow:hidden}
    .card h3{margin:0;padding:10px 12px;border-bottom:1px solid var(--line);background:#f7f9fd}
    .card .body{padding:12px}
    .nav-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
    @media (max-width:700px){.nav-grid{grid-template-columns:1fr}}
    .select-card{position:relative;display:flex;align-items:center;gap:12px;text-align:left;padding:14px;border:1px solid var(--line);border-radius:14px;background:#fff;box-shadow:0 6px 18px rgba(15,23,42,.05);cursor:pointer;transition:.15s ease}
    .select-card:hover{transform:translateY(-2px)}
    .select-card[aria-pressed="true"]{outline:2px solid color-mix(in oklab,var(--accent) 35%,white);outline-offset:2px}
    .logo-wrap{width:48px;height:48px;border-radius:12px;background:#fff;border:1px solid var(--line);display:flex;align-items:center;justify-content:center}
    .logo-wrap img{max-width:40px;max-height:40px}
    .text{display:flex;flex-direction:column;line-height:1.2}
    .title{font-weight:800}
    .desc{color:var(--muted);font-size:12px}
    .dot{width:12px;height:12px;border-radius:999px;border:2px solid color-mix(in oklab,var(--accent) 35%,white);margin-left:auto}
    .dot.active{background:var(--accent)}
    .hint{color:var(--muted);font-size:12px;margin-top:8px}
  </style>
</head>
<body>
  <div class="page">
    <!-- Info sáv -->
    <div id="notice" class="notice" role="status" aria-live="polite"></div>

    <!-- A MEGLÉVŐ LOGIN BOKSZ – változatlan mezők + gombok -->
    <div class="login-container">
      <h3>Bejelentkezés</h3>
      <input type="email" id="email" placeholder="Email:">
      <input type="password" id="password" placeholder="Jelszó:">
      <div class="login-actions">
        <button id="loginBtn" class="btn btn-primary" onclick="login()" disabled>Bejelentkezés</button>
        <button class="btn btn-ghost" onclick="toggleRegister()">⇩ Regisztráció</button>
      </div>

      <div id="register-section" style="display:none;margin-top:16px;border-top:1px solid var(--line);padding-top:12px">
        <h3 style="margin-top:0">Regisztráció</h3>
        <input type="text" id="nickname" placeholder="Becenév">
        <input type="email" id="regEmail" placeholder="Email">
        <input type="password" id="regPassword" placeholder="Jelszó">
        <input type="password" id="regConfirmPassword" placeholder="Jelszó újra">
        <button class="btn btn-primary" onclick="register()">Regisztráció</button>
      </div>
    </div>

    <!-- ÚJ: LIGA VÁLASZTÓ BLOKK (lentebb) -->
    <section class="card" aria-label="Liga választó">
      <h3>Válaszd ki a ligát</h3>
      <div class="body">
        <div class="nav-grid">
          <button class="select-card" data-league="nb1" aria-pressed="false">
            <span class="logo-wrap"><img src="fizz.png" alt="NB I – Fizz Liga logó" onerror="this.onerror=null;this.src='fizz.svg'"></span>
            <span class="text">
              <span class="title">NB I TippLiga</span>
              <span class="desc">Hazai bajnokság • dashboard.html</span>
            </span>
            <span class="dot" aria-hidden="true"></span>
          </button>

          <button class="select-card" data-league="ucl" aria-pressed="false">
            <span class="logo-wrap"><img src="ucl.png" alt="UEFA Champions League logó" onerror="this.onerror=null;this.src='ucl.svg'"></span>
            <span class="text">
              <span class="title">BL TippLiga</span>
              <span class="desc">UEFA Champions League • dashboard_ucl.html</span>
            </span>
            <span class="dot" aria-hidden="true"></span>
          </button>
        </div>
        <div id="leagueHint" class="hint">A belépés gomb a liga kiválasztása után aktiválódik.</div>
      </div>
    </section>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2xpMW1xgaWIdI2JoEhK23vkC0FTF2PKc",
      authDomain: "tippliga-4b3af.firebaseapp.com",
      projectId: "tippliga-4b3af",
      storageBucket: "tippliga-4b3af.firebasestorage.app",
      messagingSenderId: "720359845241",
      appId: "1:720359845241:web:d3d6edcac6b43ebff053a8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- Segéd: visszajelző sáv ---
    function showNotice(msg, type='success', timeoutMs=3000){
      const n = document.getElementById('notice');
      if(!n) return;
      n.textContent = msg;
      n.className = `notice show ${type}`;
      if(timeoutMs){
        setTimeout(()=>{ n.className = 'notice'; n.textContent=''; }, timeoutMs);
      }
    }

    // --- Liga választó állapot ---
    let selectedLeague = null; // 'nb1' | 'ucl'

    function computeTarget(league){
      if(league === 'ucl') return 'dashboard_ucl.html';
      if(league === 'nb1') return 'dashboard.html';
      return '';
    }

    function setSelectedLeague(code){
      selectedLeague = code;
      const cards = document.querySelectorAll('.select-card');
      cards.forEach(btn => {
        const active = btn.getAttribute('data-league') === code;
        btn.setAttribute('aria-pressed', active ? 'true' : 'false');
        const dot = btn.querySelector('.dot');
        if(dot) dot.classList.toggle('active', active);
      });
      const loginBtn = document.getElementById('loginBtn');
      if(loginBtn) loginBtn.disabled = !selectedLeague;
    }

    // --- Eseménykezelők a ligakártyákhoz ---
    document.querySelectorAll('.select-card').forEach(btn => {
      btn.addEventListener('click', () => {
        setSelectedLeague(btn.getAttribute('data-league'));
      });
    });

    // --- A meglévő funkciók MEGHAGYÁSA mellett: csak a redirect lesz ligafüggő ---
    window.toggleRegister = function () {
      const regSection = document.getElementById('register-section');
      regSection.style.display = regSection.style.display === 'none' ? 'block' : 'none';
    }

    window.register = async function () {
      const nickname = document.getElementById('nickname').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const password = document.getElementById('regPassword').value;
      const confirmPassword = document.getElementById('regConfirmPassword').value;

      if (!nickname || !email || !password || !confirmPassword) {
        alert('Minden mezőt ki kell tölteni.');
        return;
      }
      if (password !== confirmPassword) {
        alert('A jelszavak nem egyeznek.');
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        await setDoc(doc(db, 'users', user.email), { email, nickname, role: 'user' });

        // ÚJ: visszajelzés + "visszairányítás" a belépéshez
        showNotice('Sikeres regisztráció! Jelentkezz be az e-mail címeddel és jelszavaddal.', 'success', 5000);
        // 1) regisztrációs blokk bezárása
        const regSection = document.getElementById('register-section');
        if (regSection) regSection.style.display = 'none';
        // 2) e-mail mező előtöltése, fókusz a loginra
        const loginEmail = document.getElementById('email');
        const loginPass = document.getElementById('password');
        if (loginEmail) loginEmail.value = email;
        if (loginPass) loginPass.value = '';
        loginEmail?.focus();
        // 3) scroll a login tetejére
        window.scrollTo({ top: 0, behavior: 'smooth' });
        // 4) ha külön reg oldalról érkezne, biztos visszairányítás a loginra
        // (nálunk ugyanazon az oldalon van, de ez fallback)
        // setTimeout(()=>{ if(!location.pathname.toLowerCase().includes('login')) location.href='login.html'; }, 600);
      } catch (error) {
        showNotice('Hiba: ' + error.message, 'error', 6000);
      }
    }

    window.login = async function () {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      if (!email || !password) {
        alert('Add meg az email címed és a jelszavad.');
        return;
      }
      if (!selectedLeague) {
        alert('Válaszd ki a ligát a belépéshez.');
        return;
      }

      try {
        await signInWithEmailAndPassword(auth, email, password);
        const target = computeTarget(selectedLeague);
        window.location.href = target;
      } catch (error) {
        showNotice('Hiba a bejelentkezéskor: ' + error.message, 'error', 6000);
      }
    }

    // --- Kis önellenőrző tesztek a konzolban ---
    try{
      console.assert(computeTarget('nb1')==='dashboard.html','nb1 → dashboard.html');
      console.assert(computeTarget('ucl')==='dashboard_ucl.html','ucl → dashboard_ucl.html');
      console.assert(computeTarget(null)==='', 'null → empty');
      setSelectedLeague(null); // login disabled
      const btn = document.getElementById('loginBtn');
      console.assert(btn.disabled===true,'login disabled when no league');
      setSelectedLeague('nb1');
      console.assert(btn.disabled===false,'login enabled after selection');
      // showNotice teszt
      showNotice('Teszt üzenet', 'success', 1000);
      const n = document.getElementById('notice');
      console.assert(n.classList.contains('show'), 'notice megjelenik');
      setTimeout(()=>console.assert(!n.classList.contains('show'), 'notice eltűnik'), 1200);
      console.log('Login page liga-választó tesztek: OK');
    }catch(e){ console.error('Teszt hiba:', e); }
  </script>
</body>
</html>
