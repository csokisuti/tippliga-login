<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <title>BL TippLiga</title>

  <link rel="stylesheet" href="style-themed.css" />
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="fav2.png" sizes="16x16">
  <link rel="icon" type="image/png" href="fav2.png" sizes="32x32">
  <link rel="icon" type="image/png" href="fav2.png">
  <script src="loader.js" defer></script>

  <style>
    .layout{display:flex;flex-direction:column;gap:16px;max-width:1200px;margin:0 auto;padding:20px}
    .content-grid{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
    @media (max-width:1000px){.content-grid{grid-template-columns:1fr}}
    .header{display:flex;align-items:center;justify-content:space-between}
    .header-left{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .fav-crest{width:46px;height:46px;object-fit:contain;border-radius:8px;border:1px solid var(--line,#e6eaf1);background:#fff}
    .welcome{color:var(--muted,#64748b);margin:4px 0 0}

    /* liga-v√°lt√≥ balra, a c√≠m mell√© */
    .league-switch-left{margin-left:8px}
    @media (max-width:700px){.league-switch-left{width:100%;margin-left:0}}

    .nav-grid{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:14px}
    @media (max-width:1100px){.nav-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    @media (max-width:700px){.nav-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    .nav-card{display:flex;gap:12px;align-items:center;text-decoration:none;color:inherit;padding:14px;background:#fff;border:1px solid var(--line,#e6eaf1);border-radius:14px;box-shadow:0 6px 18px rgba(15,23,42,.05)}
    .nav-card .icon-wrap{position:relative;width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:color-mix(in oklab,var(--accent,#3b82f6) 15%,white);color:var(--accent,#3b82f6)}
    .nav-card .text{display:flex;flex-direction:column;line-height:1.2}
    .nav-card .title{font-weight:800}
    .nav-card .desc{color:var(--muted,#64748b);font-size:12px}
    .card{background:#fff;border:1px solid var(--line,#e6eaf1);border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,.06);overflow:hidden}
    .card h3{margin:0;padding:10px 12px;border-bottom:1px solid var(--line,#e6eaf1);background:#f7f9fd}
    .table-wrap{overflow:auto}
    .pill-badge{display:inline-flex;align-items:center;justify-content:center;min-width:18px;height:18px;padding:0 6px;margin-left:6px;border-radius:999px;background:#ef4444;color:#fff;font-size:12px;font-weight:700;line-height:1;vertical-align:middle}
    .pill-badge[hidden]{display:none!important}
    .pill-badge.countdown{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-variant-numeric:tabular-nums;letter-spacing:.2px}
    .pill-badge.countdown.urgent{animation:pulse 1s ease-in-out infinite}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
    .blink{animation:blink 1s steps(2,start) infinite}
    @keyframes blink{to{opacity:.2}}
    .fb-wrap iframe{width:100%;height:540px;border:0;overflow:hidden}
    .chat-fab{position:fixed;right:22px;bottom:22px;z-index:999;width:52px;height:52px;border-radius:999px;border:0;background:var(--accent,#3b82f6);color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 8px 26px rgba(0,0,0,.15)}
    .chat-fab .fab-badge{position:absolute;top:-4px;right:-4px;min-width:20px;height:20px;padding:0 6px;border-radius:999px;background:#ef4444;color:#fff;font-size:12px;font-weight:800;line-height:20px;display:none}
    .chat-fab.has-unread .fab-badge{display:inline-block}
    .chat-panel{position:fixed;right:22px;bottom:86px;z-index:998;width:380px;max-width:calc(100vw - 32px);max-height:70vh;display:none;flex-direction:column;background:#fff;border:1px solid var(--line,#e6eaf1);border-radius:14px;box-shadow:0 10px 32px rgba(0,0,0,.14)}
    .chat-panel.open{display:flex}
    .chat-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line,#e6eaf1);background:#f7f9fd}
    .chat-title{font-weight:800}
    #chatClose{width:28px;height:28px;border-radius:8px;font-size:18px;line-height:28px;display:inline-flex;align-items:center;justify-content:center;background:#eef2ff;color:#111;border:1px solid var(--line,#e6eaf1);cursor:pointer}
    #chatClose:hover{filter:brightness(.95)}
    .chat-list{overflow:auto;padding:8px 10px}
    .chat-empty{color:#64748b;font-size:13px;padding:8px 10px}
    .msg{padding:8px 10px;border-bottom:1px solid var(--line,#e6eaf1);display:flex;gap:8px;align-items:flex-start}
    .msg .meta{font-size:12px;color:#64748b;margin-bottom:2px}
    .msg .text{white-space:pre-wrap;word-break:break-word}
    .msg .del{margin-left:auto;background:#fee2e2;color:#991b1b;border:1px solid #fecaca;padding:2px 8px;border-radius:8px;font-size:12px;cursor:pointer;display:none}
    .msg:hover .del{display:inline-block}
    #chatComposer{display:flex;gap:8px;align-items:center;padding:10px;border-top:1px solid var(--line,#e6eaf1);background:#fff}
    #chatInput{background:#fff;color:#111;border:1px solid var(--line,#e6eaf1);height:40px;padding:8px 10px;border-radius:10px;font-size:14px;outline:none;width:100%;box-sizing:border-box}
    #chatInput::placeholder{color:#6b7280}
    #chatSendBtn{min-width:90px;padding:8px 12px;border-radius:10px;background:var(--accent,#3b82f6);color:#fff;border:0;font-weight:600;cursor:pointer}
    .btn-accent{min-height:40px;padding:10px 14px;border-radius:10px;background:var(--accent,#3b82f6);color:#fff;border:1px solid var(--line,#e6eaf1);font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
    .btn-accent:hover{filter:brightness(.95)}
    .btn-accent:focus{outline:2px solid color-mix(in oklab,var(--accent,#3b82f6) 30%,white);outline-offset:2px}
    .btn-icon{width:18px;height:18px;display:inline-block}
    .qual-green{background:color-mix(in oklab,#16a34a 12%,white)}
    .elim-red{background:color-mix(in oklab,#ef4444 10%,white)}

    .rules-modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:1000}
    .rules-modal.open{display:flex}
    .rules-dialog{width:min(900px,92vw);max-height:80vh;background:#fff;border:1px solid var(--line,#e6eaf1);border-radius:12px;box-shadow:0 16px 40px rgba(0,0,0,.2);display:flex;flex-direction:column;overflow:hidden}
    .rules-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line,#e6eaf1);background:#f7f9fd}
    .rules-title{font-weight:800}
    .rules-close{width:32px;height:32px;border:1px solid var(--line,#e6eaf1);border-radius:8px;background:#eef2ff;cursor:pointer}
    .rules-body{padding:14px;overflow:auto;line-height:1.5;color:#111;white-space:pre-wrap}
    .rules-body p{margin:0 0 10px}
    .rules-foot{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-top:1px solid var(--line,#e6eaf1);background:#fff}
    .rules-updated{font-size:12px;color:#64748b}

    .onb-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:1200;display:none;align-items:center;justify-content:center}
    .onb-backdrop.open{display:flex}
    .onb-dialog{width:min(720px,92vw);background:#fff;border:1px solid var(--line,#e6eaf1);border-radius:14px;box-shadow:0 16px 44px rgba(0,0,0,.25);overflow:hidden}
    .onb-head{padding:12px 14px;background:#f7f9fd;border-bottom:1px solid var(--line,#e6eaf1);font-weight:800}
    .onb-body{padding:14px;display:grid;gap:12px}
    .onb-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .onb-foot{padding:12px 14px;background:#fff;border-top:1px solid var(--line,#e6eaf1);display:flex;justify-content:space-between;align-items:center}
    .onb-note{font-size:12px;color:#64748b}
    .onb-actions{display:flex;gap:8px}
    .onb-btn{border:1px solid var(--line,#e6eaf1);background:#e5e7eb;color:#111;padding:8px 12px;border-radius:10px;font-weight:700;cursor:not-allowed;opacity:.6}
    .onb-btn.ok{background:var(--accent,#3b82f6);color:#fff;border-color:#dbeafe}
    .onb-btn.enabled{cursor:pointer;opacity:1}
    .onb-sel{border:1px solid var(--line,#e6eaf1);border-radius:10px;padding:8px 10px;min-width:260px}

    /* ‚ûï FIGYELEM √ÅLLAPOT: villog√≥ s√°rga/feh√©r a ‚ÄûSzezon v√©gi sorrend‚Äù k√°rty√°n */
    .nav-card.attention{
      animation:flashCard 1.1s ease-in-out infinite;
      border-color:rgba(245,158,11,.7);
    }
    @keyframes flashCard{
      0%,100%{ background:#ffffff; box-shadow:0 6px 18px rgba(15,23,42,.05); }
      50%{ background:#FFF5CC; box-shadow:0 8px 24px rgba(245,158,11,.25); }
    }
  
/* UCL Bracket collapsible card */
#uclBracketDetails summary{
  cursor:pointer;
  list-style:none;
}
#uclBracketDetails summary::-webkit-details-marker{display:none;}
#uclBracketDetails .ucl-bracket-placeholder{
  padding: 18px;
  text-align:center;
  font-size:14px;
  color: var(--muted, #64748b);
  border: 1px dashed rgba(148,163,184,.6);
  border-radius: 12px;
  background: rgba(248,250,252,.9);
}
#uclBracketDetails .ucl-bracket-wrap{
  margin-top: 12px;
  overflow-x: auto;
}
#uclBracketDetails .ucl-bracket-toolbar{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
}
#uclBracketDetails .ucl-bracket-title{
  font-size: 16px;
  font-weight: 700;
}
#uclBracketDetails .ucl-bracket-sub{
  font-size: 12px;
  opacity: .8;
}


  .ucl-bracket{overflow-x:auto}
  .ucl-bracket-grid{display:flex;gap:14px;align-items:flex-start;min-width:900px}
  .ucl-bracket-col{flex:0 0 220px;display:flex;flex-direction:column;gap:10px}
  .ucl-bracket-col h4{margin:0;font-size:13px;opacity:.85;letter-spacing:.2px}
  .ucl-slot{border:1px solid var(--line);border-radius:14px;background:rgba(255,255,255,.04);padding:10px;display:flex;flex-direction:column;gap:8px}
  .ucl-slot .row{display:flex;justify-content:space-between;gap:10px;align-items:center}
  .ucl-slot .team{display:flex;align-items:center;gap:8px;min-width:0}
  .ucl-slot .team img{width:18px;height:18px;object-fit:contain;flex:0 0 auto}
  .ucl-slot .team span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .ucl-slot .score{font-weight:700;font-variant-numeric:tabular-nums}
  .ucl-slot .meta{font-size:12px;opacity:.8;display:flex;justify-content:space-between;gap:10px}
  .ucl-slot .winner{box-shadow:0 0 0 2px rgba(34,197,94,.28) inset}
  .ucl-slot .note{font-size:12px;opacity:.8}

</style>

  <script type="module">


    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, collection, getDocs, addDoc, deleteDoc, serverTimestamp, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { computeLiveOrderFromMatches } from "./standings.js";
    import { initLeagueSwitcher } from "./league-switcher.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2xpMW1xgaWIdI2JoEhK23vkC0FTF2PKc",
      authDomain: "tippliga-4b3af.firebaseapp.com",
      projectId: "tippliga-4b3af",
      storageBucket: "tippliga-4b3af.appspot.com",
      messagingSenderId: "720359845241",
      appId: "1:720359845241:web:d3d6edcac6b43ebff053a8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

  async function loadUclBracketUiSetting() {
    const detailsEl = document.getElementById('uclBracketDetails');
    const pillEl = document.getElementById('uclBracketTogglePill');
    if (!detailsEl) return;

    try {
      const uiRef = doc(db, "settings", "ucl_bracket_ui");
      const snap = await getDoc(uiRef);
      const openByDefault = snap.exists() ? !!snap.data().openByDefault : false;
      if (openByDefault) detailsEl.setAttribute('open', '');
      else detailsEl.removeAttribute('open');
    } catch (e) {
    }

    const syncPill = () => {
      const isOpen = detailsEl.hasAttribute('open');
      if (pillEl) pillEl.textContent = isOpen ? 'Bez√°r' : 'Megnyit';
    };
    detailsEl.addEventListener('toggle', syncPill);
    syncPill();
  }


    const CHAT_COLLECTION = 'chatMessages_ucl';
    const CHAT_LAST_SEEN_FIELD = 'chatLastSeenUcl';

    const crestMap = {
      "Ajax":"ucl_crest/ajax.png","Arsenal":"ucl_crest/arsenal.png","Atalanta":"ucl_crest/atalanta.png","Athletic Bilbao":"ucl_crest/athletic.png","Atl√©tico Madrid":"ucl_crest/atletico.png","Barcelona":"ucl_crest/barcelona.png","Bayern M√ºnchen":"ucl_crest/bayern.png","Benfica":"ucl_crest/benfica.png","Borussia Dortmund":"ucl_crest/borussia.png","Bod√∏/Glimt":"ucl_crest/bodo.png","Club Bruges":"ucl_crest/brugge.png","Chelsea":"ucl_crest/chelsea.png","FC K√∂benhavn":"ucl_crest/copenhagen.png","Eintracht Frankfurt":"ucl_crest/frankfurt.png","Galatasaray":"ucl_crest/galata.png","Internazionale":"ucl_crest/inter.png","Juventus":"ucl_crest/juventus.png","Bayer Leverkusen":"ucl_crest/leverkusen.png","Liverpool":"ucl_crest/liverpool.png","Manchester City":"ucl_crest/mancity.png","Olympique Marseille":"ucl_crest/marseille.png","Monaco":"ucl_crest/monaco.png","Napoli":"ucl_crest/napoli.png","Newcastle United":"ucl_crest/newcastle.png","Olympiakosz Pireusz":"ucl_crest/olympiacos.png","Pafosz":"ucl_crest/pafos.png","Paris Saint-Germain":"ucl_crest/psg.png","PSV":"ucl_crest/psv.png","Qarabag":"ucl_crest/qarabag.png","Real Madrid":"ucl_crest/real.png","Slavia Praha":"ucl_crest/slavia.png","Sporting CP":"ucl_crest/sporting.png","Tottenham Hotspur":"ucl_crest/tottenham.png","Union Saint-Gilloise":"ucl_crest/usg.png","Villarreal":"ucl_crest/villareal.png","Kajrat Almati":"ucl_crest/kairat.png"
    };

    const facebookLinks = {
      "Ajax":"https://www.facebook.com/afcajax","Arsenal":"https://www.facebook.com/Arsenal","Atalanta":"https://www.facebook.com/atalantabc","Athletic Bilbao":"https://www.facebook.com/ATHLETICCLUB","Atl√©tico Madrid":"https://www.facebook.com/AtleticodeMadrid","Bayer Leverkusen":"https://www.facebook.com/bayer04leverkusen","Borussia Dortmund":"https://www.facebook.com/BVB","Chelsea":"https://www.facebook.com/ChelseaFC","Club Brugge":"https://www.facebook.com/clubbrugge","Eintracht Frankfurt":"https://www.facebook.com/eintracht","Barcelona":"https://www.facebook.com/fcbarcelona","Bayern M√ºnchen":"https://www.facebook.com/FCBayern","FC K√∂benhavn":"https://www.facebook.com/FCKobenhavn","Kajrat Almati":"https://www.facebook.com/fckairat","Bod√∏/Glimt":"https://www.facebook.com/Glimt1916","Internazionale":"https://www.facebook.com/Inter","Juventus":"https://www.facebook.com/Juventus","Liverpool":"https://www.facebook.com/LiverpoolFC","Monaco":"https://www.facebook.com/asmonaco","Manchester City":"https://www.facebook.com/mancity","Newcastle United":"https://www.facebook.com/newcastleunited","Olympiakosz Pireusz":"https://www.facebook.com/OlympiacosFC","Galatasaray":"https://www.facebook.com/Galatasaray","Slavia Praha":"https://www.facebook.com/slaviaofficial","Olympique Marseille":"https://www.facebook.com/OM","Pafosz":"https://www.facebook.com/pafosfc.official","Paris Saint-Germain":"https://www.facebook.com/PSG","Qarabag":"https://www.facebook.com/QarabagFK","Real Madrid":"https://www.facebook.com/RealMadrid","Benfica":"https://www.facebook.com/SLBenfica","Sporting CP":"https://www.facebook.com/SportingCP","Napoli":"https://www.facebook.com/SSCNapoli","Tottenham Hotspur":"https://www.facebook.com/TottenhamHotspur","Villarreal":"https://www.facebook.com/villarrealcf","Union Saint-Gilloise":"https://www.facebook.com/rusaintgilloise","PSV":"https://www.facebook.com/PSV"
    };

    function fmtTime(ts){ try{ return ts.toDate().toLocaleString("hu-HU",{hour12:false}) }catch{ return "" } }

    let navCdTimer=null;
    function formatCountdown(ms){
      const total=Math.max(0,Math.floor(ms/1000));
      const d=Math.floor(total/86400);
      const h=Math.floor((total%86400)/3600);
      const m=Math.floor((total%3600)/60);
      const s=total%60;
      const H=String(h).padStart(2,'0');
      const M=String(m).padStart(2,'0');
      const S=String(s).padStart(2,'0');
      const labelHTML=d>0?`${d}n ${H}<span class="blink">:</span>${M}<span class="blink">:</span>${S}`:`${H}<span class="blink">:</span>${M}<span class="blink">:</span>${S}`;
      const aria=d>0?`${d} nap ${h} √≥ra ${m} perc ${s} m√°sodperc`:`${h} √≥ra ${m} perc ${s} m√°sodperc`;
      return {labelHTML,aria};
    }
    function startNavTop8Countdown(until){
      clearInterval(navCdTimer);
      const el=document.getElementById('top8CountdownNav');
      if(!el) return;
      el.classList.add('countdown');
      if(!until){ el.hidden=true; return; }
      function tick(){
        const ms=until-new Date();
        if(ms<=0){ el.hidden=true; clearInterval(navCdTimer); return; }
        const {labelHTML,aria}=formatCountdown(ms);
        el.innerHTML=labelHTML;
        el.setAttribute('aria-live','polite');
        el.setAttribute('aria-label',`Visszasz√°ml√°l√≥: ${aria}`);
        el.title=`Hat√°rid≈ë: ${until.toLocaleString('hu-HU')}`;
        if(ms<=5*60*1000){ el.classList.add('urgent'); } else { el.classList.remove('urgent'); }
      }
      tick();
      navCdTimer=setInterval(tick,1000);
      el.hidden=false;
    }

    function parseRes(str){
      const m=String(str||"").match(/^\s*(\d+)\s*-\s*(\d+)\s*$/);
      return m?[parseInt(m[1]),parseInt(m[2])]:null;
    }

    async function buildComputedTable(){
      const teams=Object.keys(crestMap);
      const S={}; teams.forEach(t=>S[t]={team:t,MP:0,W:0,D:0,L:0,GF:0,GA:0,GD:0,Pts:0});
      const H2H={};
      const snap=await getDocs(collection(db,"ucl_matches"));
      const matchesForModule=[];

      snap.forEach(d=>{
        const m=d.data()||{};
        const rid = Number(m.roundId ?? m.round ?? 0);
        if (rid >= 9) return;
        const A=m.homeTeam||m.home||"";
        const B=m.awayTeam||m.away||"";
        const r=parseRes(m.result);
        if(A&&B&&m.result) matchesForModule.push({homeTeam:A,awayTeam:B,result:m.result});
        const a=S[A], b=S[B]; if(!a||!b||!r) return;
        const [hg,ag]=r;
        a.MP++; b.MP++;
        a.GF+=hg; a.GA+=ag; a.GD=a.GF-a.GA;
        b.GF+=ag; b.GA+=hg; b.GD=b.GF-b.GA;
        if(hg>ag){a.W++;b.L++;a.Pts+=3}
        else if(hg<ag){b.W++;a.L++;b.Pts+=3}
        else{a.D++;b.D++;a.Pts+=1;b.Pts+=1}
        const k=[A,B].slice().sort((x,y)=>x.localeCompare(y,'hu')).join('|');
        H2H[k] ||= {[A]:{Pts:0,GF:0,GA:0},[B]:{Pts:0,GF:0,GA:0}};
        if(hg>ag){H2H[k][A].Pts+=3}
        else if(hg<ag){H2H[k][B].Pts+=3}
        else{H2H[k][A].Pts+=1;H2H[k][B].Pts+=1}
        H2H[k][A].GF+=hg; H2H[k][A].GA+=ag;
        H2H[k][B].GF+=ag; H2H[k][B].GA+=hg;
      });

      function cmp(a,b){
        if(b.Pts!==a.Pts) return b.Pts-a.Pts;
        if(b.W!==a.W) return b.W-a.W;
        if(b.GD!==a.GD) return b.GD-a.GD;
        if(b.GF!==a.GF) return b.GF-a.GF;
        const k=[a.team,b.team].slice().sort((x,y)=>x.localeCompare(y,'hu')).join('|');
        const row=H2H[k];
        if(row){
          const pa=row[a.team]?.Pts??0, pb=row[b.team]?.Pts??0;
          if(pb!==pa) return pb-pa;
          const gda=(row[a.team]?.GF??0)-(row[a.team]?.GA??0);
          const gdb=(row[b.team]?.GF??0)-(row[b.team]?.GA??0);
          if(gdb!==gda) return gdb-gda;
        }
        return a.team.localeCompare(b.team,'hu');
      }

      const rows=Object.values(S).sort(cmp);
      try{
        const liveOrder=computeLiveOrderFromMatches(matchesForModule,teams);
        window.liveStandingsOrder=liveOrder;
        localStorage.setItem("liveStandingsOrder_ucl",JSON.stringify(liveOrder));
      }catch(e){ console.warn("Live standings (UCL) compute failed:",e); }

      renderComputedTable(rows);
    }

    function renderComputedTable(rows){
      const wrap=document.getElementById("tableContainer");
      const tbl=document.createElement("table");
      tbl.style.width="100%";
      tbl.style.borderCollapse="separate";
      tbl.style.borderSpacing="0";
      tbl.innerHTML=`
        <thead>
          <tr>
            <th style="text-align:right;padding:8px 10px;">H</th>
            <th style="padding:8px 10px;">Csapat</th>
            <th style="text-align:right;padding:8px 10px;">M</th>
            <th style="text-align:right;padding:8px 10px;">Gy</th>
            <th style="text-align:right;padding:8px 10px;">D</th>
            <th style="text-align:right;padding:8px 10px;">V</th>
            <th style="text-align:right;padding:8px 10px;">LG</th>
            <th style="text-align:right;padding:8px 10px;">KG</th>
            <th style="text-align:right;padding:8px 10px;">GK</th>
            <th style="text-align:right;padding:8px 10px;">P</th>
          </tr>
        </thead>
        <tbody>
          ${rows.map((r,i)=>{
            const trClass=i<8?'qual-green':(i>=24&&i<=35?'elim-red':'');
            return `
              <tr class="${trClass}">
                <td style="text-align:right;padding:8px 10px;color:#64748b;">${i+1}.</td>
                <td style="padding:8px 10px;display:flex;align-items:center;gap:8px;">
                  ${crestMap[r.team]?`<img src="${crestMap[r.team]}" alt="" style="width:22px;height:22px;border-radius:6px;border:1px solid var(--line,#e6eaf1);background:#fff;object-fit:contain">`:""}
                  <strong>${r.team}</strong>
                </td>
                <td style="text-align:right;padding:8px 10px;">${r.MP}</td>
                <td style="text-align:right;padding:8px 10px;">${r.W}</td>
                <td style="text-align:right;padding:8px 10px;">${r.D}</td>
                <td style="text-align:right;padding:8px 10px;">${r.L}</td>
                <td style="text-align:right;padding:8px 10px;">${r.GF}</td>
                <td style="text-align:right;padding:8px 10px;">${r.GA}</td>
                <td style="text-align:right;padding:8px 10px;">${r.GD}</td>
                <td style="text-align:right;padding:8px 10px;font-weight:800;">${r.Pts}</td>
              </tr>`;
          }).join("")}
        </tbody>
      `;
      wrap.innerHTML="";
      wrap.appendChild(tbl);
    }

    let currentUserEmail=""; let currentUserNick=""; let currentUserRole="user";
    let favouriteTeamucl=""; let chatLastSeen=null;

    document.addEventListener("DOMContentLoaded",()=>{
      /* Liga-v√°lt√≥ mount: BAL SZ√âL ‚Äì c√≠m mellett */
      initLeagueSwitcher({ mountTarget: document.getElementById('leagueSwitchMount') });

      

    function normalizeTeamName(t){ return (t||"").toString().trim(); }

    async function loadBracketUISettings(){
      try{
        const sRef = doc(db,"settings","ucl_bracket_ui");
        const sSnap = await getDoc(sRef);
        const v = sSnap.exists() ? (sSnap.data()||{}) : {};
        const openByDefault = !!v.openByDefault;
        const det = document.getElementById("uclBracketDetails");
        if(det) det.open = openByDefault;
      }catch(e){}
    }

    function slotTitleMap(){
      const map={};
      for(let i=1;i<=8;i++) map["PO"+i] = "Play-off "+i;
      for(let i=1;i<=8;i++) map["R16_"+i] = "Nyolcadd√∂nt≈ë "+i;
      for(let i=1;i<=4;i++) map["QF"+i] = "Negyedd√∂nt≈ë "+i;
      for(let i=1;i<=2;i++) map["SF"+i] = "El≈ëd√∂nt≈ë "+i;
      map["F1"]="D√∂nt≈ë";
      return map;
    }

    function crestForTeam(team){
      const t=normalizeTeamName(team);
      const hit = crestMap?.[t];
      return hit ? hit : "";
    }

    function parseResLocal(result){
      return parseRes(result);
    }

    function computeAggregateForSlot(slot, matchById){
      const home=normalizeTeamName(slot.homeTeam);
      const away=normalizeTeamName(slot.awayTeam);
      if(!home || !away) return null;
      let hg=0, ag=0, legs=0;
      (slot.matchIds||[]).forEach(id=>{
        const m = matchById.get(id);
        if(!m || !m.result) return;
        const r = parseResLocal(m.result);
        if(!r) return;
        const mh=normalizeTeamName(m.homeTeam||m.home||"");
        const ma=normalizeTeamName(m.awayTeam||m.away||"");
        if(mh===home && ma===away){ hg+=r[0]; ag+=r[1]; legs++; }
        else if(mh===away && ma===home){ hg+=r[1]; ag+=r[0]; legs++; }
      });
      if(legs===0) return null;
      return {hg,ag};
    }

    function renderBracket(bracketDocs, matchById){
      const mount=document.getElementById("uclBracketContainer");
      if(!mount) return;
      const titles=slotTitleMap();
      const rounds=[{k:"PO",t:"Play-off"},{k:"R16",t:"Nyolcadd√∂nt≈ë"},{k:"QF",t:"Negyedd√∂nt≈ë"},{k:"SF",t:"El≈ëd√∂nt≈ë"},{k:"F",t:"D√∂nt≈ë"}];
      const cols = rounds.map(r=>({round:r.k,title:r.t,slots:[]}));
      const byId={};
      bracketDocs.forEach(b=>{ byId[b.id]=b; });
      cols.forEach(c=>{
        const ids=[];
        if(c.round==="PO") for(let i=1;i<=8;i++) ids.push("PO"+i);
        if(c.round==="R16") for(let i=1;i<=8;i++) ids.push("R16_"+i);
        if(c.round==="QF") for(let i=1;i<=4;i++) ids.push("QF"+i);
        if(c.round==="SF") for(let i=1;i<=2;i++) ids.push("SF"+i);
        if(c.round==="F") ids.push("F1");
        c.slots = ids.map(id=>({id,...(byId[id]||{id,homeTeam:"",awayTeam:"",matchIds:[],decidedByPenalties:false,penaltyWinner:""})}));
      });

      const grid=document.createElement("div");
      grid.className="ucl-bracket-grid";

      cols.forEach(c=>{
        const col=document.createElement("div");
        col.className="ucl-bracket-col";
        const h=document.createElement("h4");
        h.textContent=c.title;
        col.appendChild(h);

        c.slots.forEach(s=>{
          const card=document.createElement("div");
          const agg=computeAggregateForSlot(s, matchById);
          const home=normalizeTeamName(s.homeTeam);
          const away=normalizeTeamName(s.awayTeam);

          card.className="ucl-slot";
          const winner = (s.decidedByPenalties && (s.penaltyWinner==="home"||s.penaltyWinner==="away")) ? s.penaltyWinner : "";
          if(winner==="home" || winner==="away"){
            if(winner==="home") card.classList.add("winner");
            if(winner==="away") card.classList.add("winner");
          }

          const row1=document.createElement("div"); row1.className="row";
          const t1=document.createElement("div"); t1.className="team";
          const img1=document.createElement("img"); const crest1=crestForTeam(home); if(crest1) img1.src=crest1; else img1.style.display="none";
          const span1=document.createElement("span"); span1.textContent=home||"‚Äî";
          t1.appendChild(img1); t1.appendChild(span1);
          const sc1=document.createElement("div"); sc1.className="score"; sc1.textContent=agg?String(agg.hg):"";
          row1.appendChild(t1); row1.appendChild(sc1);

          const row2=document.createElement("div"); row2.className="row";
          const t2=document.createElement("div"); t2.className="team";
          const img2=document.createElement("img"); const crest2=crestForTeam(away); if(crest2) img2.src=crest2; else img2.style.display="none";
          const span2=document.createElement("span"); span2.textContent=away||"‚Äî";
          t2.appendChild(img2); t2.appendChild(span2);
          const sc2=document.createElement("div"); sc2.className="score"; sc2.textContent=agg?String(agg.ag):"";
          row2.appendChild(t2); row2.appendChild(sc2);

          const meta=document.createElement("div"); meta.className="meta";
          const left=document.createElement("div"); left.textContent=titles[s.id]||s.id;
          const right=document.createElement("div");
          const legCount = (s.matchIds||[]).filter(Boolean).length;
          right.textContent = legCount ? (legCount===1 ? "1 meccs" : "2 meccs") : "";
          meta.appendChild(left); meta.appendChild(right);

          card.appendChild(meta);
          card.appendChild(row1);
          card.appendChild(row2);

          if(s.decidedByPenalties){
            const note=document.createElement("div");
            note.className="note";
            note.textContent = "Tov√°bbjut√°s 11-esekkel";
            card.appendChild(note);
          }

          col.appendChild(card);
        });

        grid.appendChild(col);
      });

      mount.innerHTML="";
      mount.appendChild(grid);
    }

    
    async function initBracket(){
      await loadBracketUISettings();
      const mount=document.getElementById("uclBracketContainer");
      if(mount) mount.textContent="√Ågrajz bet√∂lt√©se‚Ä¶";
      const matchById=new Map();
      let currentBracket=[];

      try{
        const ms = await getDocs(collection(db,"ucl_matches"));
        ms.forEach(d=>{
          const m=d.data()||{};
          matchById.set(d.id,{id:d.id,...m});
        });
      }catch(e){}

      try{
        const bSnap = await getDoc(doc(db,"settings","ucl_bracket"));
        const data = bSnap.exists() ? (bSnap.data()||{}) : {};
        const slots = (data.slots && typeof data.slots==="object") ? data.slots : {};
        const arr = Object.keys(slots).map(k=>({id:k, ...(slots[k]||{})}));
        currentBracket = arr;
      }catch(e){}

      renderBracket(currentBracket, matchById);

      try{
        onSnapshot(doc(db,"settings","ucl_bracket"), (snap)=>{
          const data = snap.exists() ? (snap.data()||{}) : {};
          const slots = (data.slots && typeof data.slots==="object") ? data.slots : {};
          const arr = Object.keys(slots).map(k=>({id:k, ...(slots[k]||{})}));
          currentBracket = arr;
          renderBracket(currentBracket, matchById);
        });
      }catch(e){}

      try{
        onSnapshot(collection(db,"ucl_matches"), (snap)=>{
          snap.forEach(d=>{
            const m=d.data()||{};
            matchById.set(d.id,{id:d.id,...m});
          });
          renderBracket(currentBracket, matchById);
        });
      }catch(e){}
    }


onAuthStateChanged(auth,async(user)=>{
        if(!user){window.location.href="login.html";return}
        currentUserEmail=user.email;

        const userRef=doc(db,"users",currentUserEmail);
        const userSnap=await getDoc(userRef);
        if(userSnap.exists()){
          const data=userSnap.data();
          currentUserNick=data.nickname||currentUserEmail;
          currentUserRole=data.role||"user";
          favouriteTeamucl=data.favouriteTeamucl||"";
          chatLastSeen=data[CHAT_LAST_SEEN_FIELD]||null;
        }else{
          currentUserNick=currentUserEmail; currentUserRole="user"; favouriteTeamucl=""; chatLastSeen=null;
        }

        document.getElementById("welcome").textContent=`√údv, ${currentUserNick}!`;
        if(currentUserRole==="admin"){document.getElementById("adminLink").style.display="flex"}

        if(favouriteTeamucl){
          const themeClass="theme-"+favouriteTeamucl.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-");
          document.body.classList.add(themeClass);
          const crest=crestMap[favouriteTeamucl];
          if(crest){
            const img=document.getElementById("favCrest");
            img.src=crest; img.alt=favouriteTeamucl; img.hidden=false;
          }
        }

        // Onboarding (ha nincs BL kedvenc)
        await maybeForceFavoriteSetupUcl(userRef);

        // Top8 hat√°rid≈ë visszasz√°ml√°l√≥
        try{
          const snap=await getDoc(doc(db,'settings','positionsLock_ucl'));
          let until=null; let isLocked=false;
          if(snap.exists()){
            const d=snap.data()||{};
            until=d.lockUntil?.toDate?.()||null;
            const now=new Date();
            isLocked=!!d.isLocked||(until&&now>=until);
          }
          startNavTop8Countdown(isLocked?null:until);
        }catch(e){ startNavTop8Countdown(null); }

        await buildComputedTable();
        onSnapshot(collection(db,"ucl_matches"),()=>buildComputedTable());

        try{
          const fbLink=facebookLinks[favouriteTeamucl];
          if(fbLink){
            const fbDiv=document.createElement("div");
            fbDiv.className="fb-wrap";
            fbDiv.innerHTML=`
              <iframe 
                src="https://www.facebook.com/plugins/page.php?href=${encodeURIComponent(fbLink)}&tabs=timeline&width=560&height=540&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId"
                scrolling="no" frameborder="0" allowfullscreen="true"
                allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>`;
            document.getElementById("facebookFeedContainer").appendChild(fbDiv);
          }
        }catch(e){console.warn(e)}

        // Leadatlan tippek jelv√©ny a Meccstippek k√°rty√°n
        function updatePendingBadgeUcl(){
          const badge = document.getElementById('tipsBadgeUcl');
          const matchesCard = document.getElementById('matchesCard');
          if (!badge) return;
          getDocs(query(collection(db,"ucl_matches"), where("startTime", ">=", new Date()))).then(upcomingSnap=>{
            const upcoming = upcomingSnap.docs.map(d => ({ id:d.id, ...d.data() }));
            getDocs(query(collection(db,"ucl_tips"), where("user","==", currentUserEmail))).then(tipsSnap=>{
              const tippedIds = new Set();
              tipsSnap.forEach(x=>{ const t=x.data(); if(t?.matchId) tippedIds.add(t.matchId); 
        initBracket();
});
              const pending = upcoming.filter(m => !tippedIds.has(m.id)).length;
              if (pending>0){ badge.textContent = pending; badge.hidden = false; matchesCard?.classList.add('attention'); } else { badge.hidden = true; matchesCard?.classList.remove('attention'); }
            });
          });
        }
        updatePendingBadgeUcl();
        onSnapshot(collection(db,"ucl_matches"), updatePendingBadgeUcl);
        onSnapshot(query(collection(db,"ucl_tips"), where("user","==", currentUserEmail)), updatePendingBadgeUcl);

        // ‚ûï FIGYELEM: villog√≥ k√°rtya ‚Äì ha nincs minden tipp meg
        async function checkPositionsCompleteness(){
          const card = document.getElementById('positionsCard');
          if (!card) return;

          // Lock √°llapot
          let locked=false;
          try{
            const s=await getDoc(doc(db,'settings','positionsLock_ucl'));
            if(s.exists()){
              const d=s.data()||{};
              const until=d.lockUntil?.toDate?.()||null;
              const now=new Date();
              locked = !!d.isLocked || (until && now>=until);
            }
          }catch{}

          if(locked){ card.classList.remove('attention'); return; }

          // Saj√°t tippek √°llapota
          let top8Ok=false, champOk=false, goldenOk=false;
          try{
            const t=await getDoc(doc(db,"ucl_top8Tips", currentUserEmail));
            if(t.exists()){
              const arr=t.data()?.picks;
              top8Ok = Array.isArray(arr) && arr.filter(Boolean).length>=8;
            }
          }catch{}
          try{
            const c=await getDoc(doc(db,"ucl_championPickTips", currentUserEmail));
            champOk = c.exists() && !!c.data()?.team;
          }catch{}
          try{
            const g=await getDoc(doc(db,"ucl_goldenBootTips", currentUserEmail));
            goldenOk = g.exists() && !!g.data()?.player;
          }catch{}

          const incomplete = !(top8Ok && champOk && goldenOk);
          card.classList.toggle('attention', incomplete);
        }
        await checkPositionsCompleteness();
        onSnapshot(doc(db,'settings','positionsLock_ucl'), checkPositionsCompleteness);
        onSnapshot(doc(db,'ucl_top8Tips', currentUserEmail), checkPositionsCompleteness);
        onSnapshot(doc(db,'ucl_championPickTips', currentUserEmail), checkPositionsCompleteness);
        onSnapshot(doc(db,'ucl_goldenBootTips', currentUserEmail), checkPositionsCompleteness);

        initChat(userRef);
        if(window.hideLoader) hideLoader();
      });

      document.getElementById("logout").addEventListener("click",()=>{signOut(auth).then(()=>window.location.href="login.html")});

      // Szab√°lyzat mod√°l
      const rulesModal=document.getElementById('rulesModal');
      const openRulesBtn=document.getElementById('openRules');
      const closeRules=document.getElementById('closeRules');
      const closeRules2=document.getElementById('closeRules2');
      function openRulesModal(){rulesModal.classList.add('open')}
      function closeRulesModal(){rulesModal.classList.remove('open')}
      openRulesBtn?.addEventListener('click',openRulesModal);
      closeRules?.addEventListener('click',closeRulesModal);
      closeRules2?.addEventListener('click',closeRulesModal);
      rulesModal?.addEventListener('click',(e)=>{if(e.target===rulesModal) closeRulesModal()});
    });

    function initChat(userRef){
      const fab=document.getElementById('chatToggle');
      const fabBadge=document.getElementById('chatFabBadge');
      const panel=document.getElementById('chatPanel');
      const closeBtn=document.getElementById('chatClose');
      const listEl=document.getElementById('chatMessages');
      const inputEl=document.getElementById('chatInput');
      const sendBtn=document.getElementById('chatSendBtn');

      function open(){panel.classList.add('open');setTimeout(()=>inputEl?.focus(),50);markSeen()}
      function close(){panel.classList.remove('open')}
      function toggle(){panel.classList.contains('open')?close():open()}
      fab.addEventListener('click',toggle);
      closeBtn.addEventListener('click',close);

      let lastSeenMs=chatLastSeen?.toMillis?chatLastSeen.toMillis():0;
      const qAll=query(collection(db,CHAT_COLLECTION),orderBy('ts','asc'));
      onSnapshot(qAll,snap=>{
        listEl.innerHTML='';
        if(snap.empty){
          const empty=document.createElement('div');
          empty.className='chat-empty';
          empty.textContent='M√©g nincs √ºzenet. L√©gy te az els≈ë!';
          listEl.appendChild(empty);
        }else{
          let unread=0;
          snap.forEach(docu=>{
            const d=docu.data();
            const tsMs=d.ts?.toMillis?.()||0;
            if(tsMs>lastSeenMs) unread++;
            const row=document.createElement('div');
            row.className='msg';
            row.innerHTML=`
              <div style="flex:1 1 auto">
                <div class="meta"><strong>${d.nick||'Ismeretlen'}</strong> ‚Ä¢ ${d.ts?fmtTime(d.ts):''}</div>
                <div class="text">${(d.text||'').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>
              </div>`;
            const canDelete=(currentUserRole==='admin')||(d.email===currentUserEmail);
            if(canDelete){
              const del=document.createElement('button');
              del.className='del';
              del.textContent='T√∂rl√©s';
              del.title='√úzenet t√∂rl√©se';
              del.addEventListener('click',async()=>{try{await deleteDoc(doc(db,CHAT_COLLECTION,docu.id))}catch(e){console.warn('Del failed',e)}});
              row.appendChild(del);
            }
            listEl.appendChild(row);
          });
          if(!panel.classList.contains('open')&&unread>0){
            fab.classList.add('has-unread');
            fabBadge.textContent=unread>99?'99+':String(unread);
          }else{
            fab.classList.remove('has-unread');
            fabBadge.textContent='';
          }
          setTimeout(()=>{listEl.scrollTop=listEl.scrollHeight;},0);
        }
      }, err => console.warn('chat snapshot error:', err));

      sendBtn.addEventListener('click',async ()=>{
        const txt=(inputEl.value||'').trim();
        if(!txt){inputEl.focus();return}
        const backup=txt;
        inputEl.value='';
        try{
          await addDoc(collection(db,CHAT_COLLECTION),{
            email: currentUserEmail,
            nick: currentUserNick || 'Ismeretlen',
            text: backup,
            ts: serverTimestamp()
          });
          if(panel.classList.contains('open')) await markSeen();
        }catch(e){
          console.warn('Chat send failed:', e);
          inputEl.value=backup; inputEl.focus();
        }
      });
      inputEl.addEventListener('keydown',(e)=>{ if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); sendBtn.click(); } });

      async function markSeen(){
        try{
          await setDoc(userRef,{ [CHAT_LAST_SEEN_FIELD]: serverTimestamp() },{ merge:true });
          lastSeenMs=Date.now();
          fab.classList.remove('has-unread');
          fabBadge.textContent='';
        }catch(e){ console.warn('markSeen failed', e); }
      }
    }

    async function maybeForceFavoriteSetupUcl(userRef){
      const onbEl=document.getElementById("onbFav_ucl");
      const onbSel=document.getElementById("onbFavSelect_ucl");
      const onbRem=document.getElementById("onbRem_ucl");
      const onbSave=document.getElementById("onbFavSave_ucl");

      if(favouriteTeamucl) return;

      if(onbSel){
        onbSel.innerHTML = `<option value="">‚Äì V√°lassz BL-csapatot ‚Äì</option>` + Object.keys(crestMap).map(t=>`<option value="${t}">${t}</option>`).join("");
        onbSel.addEventListener("change",()=>{
          const ok=!!onbSel.value;
          if(onbSave){ onbSave.disabled=!ok; onbSave.classList.toggle("enabled",ok); }
        });
      }
      if(onbSave){ onbSave.disabled=true; onbSave.classList.remove("enabled"); }
      if(onbSel) onbSel.value="";
      if(onbRem) onbRem.checked=true;
      if(onbEl) onbEl.classList.add("open");

      if(onbSave){
        onbSave.onclick=async ()=>{
          if(!onbSel?.value) return;
          try{
            await setDoc(userRef,{ favouriteTeamucl:onbSel.value, reminderEmailUcl: !!onbRem?.checked },{ merge:true });
            favouriteTeamucl=onbSel.value;
            const themeClass="theme-"+favouriteTeamucl.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-');
            document.body.classList.add(themeClass);
            const crest=crestMap[favouriteTeamucl];
            if(crest){
              const img=document.getElementById("favCrest");
              img.src=crest; img.alt=favouriteTeamucl; img.hidden=false;
            }
            onbEl?.classList.remove("open");
          }catch(e){
            alert("Hiba a be√°ll√≠t√°s ment√©sekor. Pr√≥b√°ld √∫jra.");
          }
        };
      }
    }
  
  loadUclBracketUiSetting();


</script>
</head>
<body>
  <div class="layout">
    <div class="header">
      <div class="header-left">
        <img id="favCrest" class="fav-crest" alt="" hidden>
        <div>
          <h1>BL TippLiga</h1>
          <p id="welcome" class="welcome"></p>
        </div>
        <!-- LIGA / TIPPJ√ÅT√âK V√ÅLASZT√ì ‚Äì BAL OLDALON A C√çM MELLETT -->
        <div id="leagueSwitchMount" class="league-switch-left" aria-label="Tippj√°t√©k v√°laszt√≥"></div>
      </div>
      <div>
        <button id="logout" class="btn-accent" aria-label="Kil√©p√©s">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M16 13v-2H7V7l-5 5 5 5v-4h9zm3-10H11a2 2 0 0 0-2 2v3h2V5h8v14h-8v-3H9v3a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
          Kil√©p√©s
        </button>
        <button id="openRules" class="btn-accent" style="display:block;margin-top:10px;">Szab√°lyzat</button>
      </div>
    </div>

    <nav class="nav-grid">
      <a class="nav-card" href="dashboard_ucl.html">
        <div class="icon-wrap" aria-hidden="true"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3 2 12h3v8h6v-5h2v5h6v-8h3L12 3z"/></svg></div>
        <div class="text"><span class="title">F≈ëoldal</span><span class="desc">Tabella, h√≠rek, kedvencek</span></div>
      </a>
      <a id="positionsCard" class="nav-card" href="positions_ucl.html">
        <div class="icon-wrap" aria-hidden="true"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M9 4h6v16H9zM3 10h4v10H3zm14 6h4v4h-4z"/></svg></div>
        <div class="text">
          <span class="title">Szezon v√©gi sorrend <span id="top8CountdownNav" class="pill-badge countdown" hidden></span></span>
          <span class="desc">Ligaf√°zis Top 8, gy≈ëztes, g√≥lkir√°ly</span>
        </div>
      </a>
      <a id="matchesCard" class="nav-card" href="matches_ucl.html">
        <div class="icon-wrap" aria-hidden="true"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20Zm-1.7 3.5 1.7-1.2 1.7 1.2-.6 2 1.6 1.2h-2L12 7.2l-1.7 1.5h-2l1.6-1.2-.6-2ZM6.2 9.3l1.9-.3.9 1.7-.8 1.8-1.8.2-1.2-1.6 1-1.8Zm11.6 0 1 1.8-1.2 1.6-1.8-.2-.8-1.8.9-1.7 1.9.3ZM8.9 17.9l-.7-1.9 1.5-1.2h1.9l.9 1.7-1.5 1.4-2.1 0Zm6.2 0-2.1 0-1.5-1.4.9-1.7h1.9l1.5 1.2-.7 1.9Z"/></svg></div>
        <div class="text"><span class="title">Meccstippek <span id="tipsBadgeUcl" class="pill-badge" hidden></span></span><span class="desc">K√∂zelg≈ë meccsek & tippek</span></div>
      </a>
      <a class="nav-card" href="results_ucl.html">
        <div class="icon-wrap" aria-hidden="true"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M9 2h6a2 2 0 0 1 2 2h2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4h2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2Zm0 4h6V4H9v2Zm1 6h8v2h-8v-2Zm0 4h8v2h-8v-2ZM6 10h3v2H6v-2Z"/></svg></div>
        <div class="text"><span class="title">Eredm√©nyek</span><span class="desc">Fordul√≥nk√©nti bont√°s</span></div>
      </a>
      <a class="nav-card" href="leaderboard_ucl.html">
        <div class="icon-wrap" aria-hidden="true"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3h3a2 2 0 0 1 2 2v1a5 5 0 0 1-5 5h-1a6 6 0 0 1-4 3.9V17h3v2H9v-2h3v-2.1A6 6 0 0 1 8 11H7A5 5 0 0 1 2 6V5a2 2 0 0 1 2-2h3a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2Zm-2 2H9V3h6v2ZM4 6a3 3 0 0 0 3 3h1a4 4 0 0 1-1 3h1a3 3 0 0 0 3-3V5Z"/></svg></div>
        <div class="text"><span class="title">√ñsszpontsz√°m</span><span class="desc">Toplista & b√≥nusz</span></div>
      </a>
      <a class="nav-card" href="profile_ucl.html">
        <div class="icon-wrap" aria-hidden="true"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-9 2.5-9 5.5V22h18v-2.5C21 16.5 17 14 12 14Z"/></svg></div>
        <div class="text"><span class="title">Profil</span><span class="desc">Be√°ll√≠t√°sok & kedvenc csapat</span></div>
      </a>
      <a class="nav-card" id="adminLink" href="admin_ucl.html" style="display:none;">
        <div class="icon-wrap" aria-hidden="true"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M12 8a4 4 0 1 1-4 4 4 4 0 0 1 4-4Zm8.94 4a6.94 6.94 0 0 0-.12-1l2.02-1.56-2-3.46-2.44 1a6.9 6.9 0 0 0-1.74-1l-.37-2.6H9.71l-.37-2.6a6.9 6.9 0 0 0-1.74 1l-2.44-1-2 3.46L5.18 11a7 7 0 0 0 0 2l-2.02 1.56 2 3.46 2.44-1a6.9 6.9 0 0 0 1.74 1l.37 2.6h4.56l.37-2.6a6.9 6.9 0 0 0 1.74-1l2.44 1 2-3.46L20.82 13a6.94 6.94 0 0 0 .12-1Z"/></svg></div>
        <div class="text"><span class="title">Admin</span><span class="desc">Szezon-z√°r & be√°ll√≠t√°sok</span></div>
      </a>
    </nav>

<section class="card" id="uclBracketCard">
  <details id="uclBracketDetails">
    <summary>
      <div class="ucl-bracket-toolbar">
        <div>
          <div class="ucl-bracket-title">BL kies√©ses √°grajz</div>
          <div class="ucl-bracket-sub">A 9. fordul√≥t√≥l a meccsek m√°r csak itt sz√°m√≠tanak.</div>
        </div>
        <span class="pill" id="uclBracketTogglePill">Megnyit</span>
      </div>
    </summary>

    <div class="ucl-bracket-wrap" id="uclBracketContainer">
      <div class="ucl-bracket-placeholder">
        Az √°grajz adatait az admin oldalon tudod felt√∂lteni.
      </div>
    </div>
  </details>
</section>


    <div class="content-grid">
      <section class="card table-wrap">
        <h3>BL tabella</h3>
        <div id="tableContainer"></div>
      </section>
      <section class="card">
        <h3>Csapatod h√≠rei</h3>
        <div id="facebookFeedContainer"></div>
      </section>
    </div>
  </div>

  <!-- Onboarding (BL) -->
  <div id="onbFav_ucl" class="onb-backdrop" aria-modal="true" role="dialog" aria-labelledby="onbFavTitle_ucl">
    <div class="onb-dialog">
      <div class="onb-head" id="onbFavTitle_ucl">√údv a BL TippLig√°ban! üéâ</div>
      <div class="onb-body">
        <div>El≈ësz√∂r <strong>v√°laszd ki a kedvenc BL-csapatodat</strong>, √©s d√∂ntsd el, k√©rsz-e e-mailes eml√©keztet≈ët a tippek lead√°s√°ra. <em>K√©s≈ëbb a Profil oldalon b√°rmikor m√≥dos√≠that√≥.</em></div>
        <div class="onb-row">
          <label for="onbFavSelect_ucl"><strong>Kedvenc BL-csapat</strong></label>
          <select id="onbFavSelect_ucl" class="onb-sel"></select>
        </div>
        <div class="onb-row">
          <label style="display:flex;align-items:center;gap:10px;">
            <input id="onbRem_ucl" type="checkbox" checked>
            <span>E-mailes eml√©keztet≈ët k√©rek</span>
          </label>
        </div>
      </div>
      <div class="onb-foot">
        <span class="onb-note">Tipp: Ezeket k√©s≈ëbb a <strong>Profil</strong> oldalon is m√≥dos√≠thatod.</span>
        <div class="onb-actions">
          <button id="onbFavSave_ucl" class="onb-btn ok" disabled>Ment√©s √©s folytat√°s</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Szab√°lyzat mod√°l -->
  <div id="rulesModal" class="rules-modal" aria-modal="true" role="dialog" aria-labelledby="rulesTitle">
    <div class="rules-dialog">
      <div class="rules-head">
        <div id="rulesTitle" class="rules-title">BL TippLiga ‚Äì Szab√°lyzat</div>
        <button id="closeRules" class="rules-close" aria-label="Bez√°r√°s">‚úï</button>
      </div>
      <div id="rulesBody" class="rules-body">
<p><strong>1) A j√°t√©k c√©lja</strong><br>
A TippLiga c√©lja, hogy a j√°t√©kosok min√©l t√∂bb pontot gy≈±jtsenek a <strong>Bajnokok Lig√°ja</strong> m√©rk≈ëz√©seinek eredm√©nyeinek √©s a <strong>szezon kimeneteleinek</strong> megtippel√©s√©vel.</p>

<p><strong>2) Tippel√©s</strong><br>
‚Äì Minden m√©rk≈ëz√©sre <strong>1√ó2</strong> (Hazai‚ÄìD√∂ntetlen‚ÄìVend√©g) tipp adhat√≥ le.<br>
‚Äì A tipp a m√©rk≈ëz√©s <strong>kezd√©si id≈ëpontj√°ig</strong> szabadon m√≥dos√≠that√≥.<br>
‚Äì <strong>Minden j√°t√©knapon</strong> (nem fordul√≥nk√©nt) <strong>egyetlen m√©rk≈ëz√©sre kijel√∂lhet≈ë ‚ÄûDupla t√©t‚Äù</strong>, amely <strong>k√©tszeres pontszorz√≥t</strong> ad.<br>
‚Äì A dupl√°z√°s m√≥dos√≠t√°sa csak az adott j√°t√©knap <strong>els≈ë m√©rk≈ëz√©s√©nek kezd√©s√©ig</strong> lehets√©ges, ut√°na r√∂gz√ºl.</p>

<p><strong>3) B√≥nusz tippek</strong><br>
‚Äì <strong>V√©gs≈ë gy≈ëztes</strong>: tippeld meg, ki nyeri a BL-t.<br>
‚Äì <strong>G√≥lkir√°ly</strong>: tippeld meg, ki szerzi a legt√∂bb g√≥lt.<br>
‚Äì Ezekre a b√≥nusz tippekre <strong>odds alapj√°n</strong> t√∂rt√©nik a pontoz√°s, de egy k√©plettel m√≥dos√≠tva van az √©rt√©k, hogy ne legyenek nagyon magas b√≥nusz √©rt√©kek. A b√≥nusz tippekn√©l a kijelzett <strong>sz√°zal√©kos √©rt√©k (%)</strong> <em>pluszban hozz√°ad√≥dik</em> a j√°t√©kos <strong>v√©gs≈ë pontsz√°m√°hoz</strong>.</p>

<p><strong>4) Pontsz√°m√≠t√°s</strong><br>
‚Äì <strong>Meccsek</strong>: helyes tipp = <strong>odds √ó t√©t</strong> (alap t√©t = 1 pont, <strong>dupla</strong> eset√©n = 2 pont).<br>
‚Äì <strong>Rossz tipp</strong>: 0 pont.<br>
‚Äì <strong>B√≥nusz tippek</strong> (V√©gs≈ë gy≈ëztes, G√≥lkir√°ly): a kijelzett <strong>%</strong> hozz√°ad√≥dik a <strong>v√©gs≈ë √∂sszpontsz√°mhoz</strong>,<br>amit a meccstippekkel gy≈±jt√∂tt a j√°t√©kos.
‚Äì Az oddsok <strong>manu√°lisan</strong> ker√ºlnek r√∂gz√≠t√©sre a tipp(ek) felt√∂lt√©sekor; a kezd√©sig az <strong>odds m√≥dosulhat</strong>, √©s nem felt√©tlen√ºl egyezik az aktu√°lisan √©rv√©nyes k√ºls≈ë oddsokkal.</p>

<p><strong>5) Eredm√©nyek √©s rangsor</strong><br>
‚Äì Pont√∂sszes√≠t√©s <strong>j√°t√©knaponk√©nt</strong> √©s <strong>a teljes szezonra</strong>.<br>
‚Äì A <strong>Toplista</strong> a j√°t√©kosokat az <strong>√∂sszpontsz√°m</strong> alapj√°n sorolja.</p>

<p><strong>6) Tipp</strong><br>
‚Äì A <strong>Profil</strong> men√ºben v√°laszd ki a kedvenc <strong>BL-csapatodat</strong>, √≠gy a fel√ºlet sz√≠nei ahhoz igazodnak, √©s a <strong>klubc√≠mere</strong> is megjelenik a profilodn√°l.</p>
      </div>
      <div class="rules-foot">
        <span id="rulesUpdated" class="rules-updated">Utolj√°ra friss√≠tve: 2025. 09. 12.</span>
        <button id="closeRules2" class="btn-accent">Bez√°r√°s</button>
      </div>
    </div>
  </div>

  <button id="chatToggle" class="chat-fab" title="K√∂z√∂ss√©gi chat">
    <svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M4 4h16a2 2 0 0 1 2 2v11a2 2 0 0 1 2 2H8l-4 3V6a2 2 0 0 1 2-2Z"/></svg>
    <span id="chatFabBadge" class="fab-badge"></span>
  </button>

  <section id="chatPanel" class="chat-panel" aria-label="K√∂z√∂ss√©gi chat">
    <div class="chat-head">
      <div class="chat-title">K√∂z√∂ss√©gi chat</div>
      <button id="chatClose" aria-label="Bez√°r√°s">‚úï</button>
    </div>
    <div id="chatMessages" class="chat-list" role="log" aria-live="polite"></div>
    <div id="chatComposer">
      <input id="chatInput" type="text" placeholder="√çrj valamit‚Ä¶" autocomplete="off">
      <button id="chatSendBtn">K√ºld√©s</button>
    </div>
  </section>
</body>
</html>
