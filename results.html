<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Eredm√©nyek</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 20px; }
    h1 { background: #333; color: white; padding: 10px; border-radius: 5px; }
    .round { margin-top: 30px; background: #ddd; padding: 8px; font-weight: bold; }
    .match { background: white; border: 1px solid #ccc; margin-bottom: 10px; padding: 10px; border-radius: 5px; }
    .correct { background-color: #d4edda; }
    .incorrect { background-color: #f8d7da; }
    .unknown { background-color: #f0f0f0; }
    .footer { font-weight: bold; margin-top: 10px; }
    .gray { color: #777; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore, collection, getDocs, query, where, doc, getDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2xpMW1xgaWIdI2JoeknDtykQ5xvU8EAY",
      authDomain: "tippliga.firebaseapp.com",
      projectId: "tippliga",
      storageBucket: "tippliga.appspot.com",
      messagingSenderId: "316225181508",
      appId: "1:316225181508:web:ff3a56ef4e2645fc8f15f1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const tipsSnap = await getDocs(query(collection(db, "tips"), where("userId", "==", user.uid)));
      const tips = [];
      tipsSnap.forEach(doc => tips.push({ id: doc.id, ...doc.data() }));

      const matchesSnap = await getDocs(collection(db, "matches"));
      const matches = [];
      matchesSnap.forEach(doc => matches.push({ id: doc.id, ...doc.data() }));

      const rounds = {};

      tips.forEach(tip => {
        const match = matches.find(m => m.id === tip.matchId);
        if (!match) return;
        const round = match.roundId || "Ismeretlen fordul√≥";
        if (!rounds[round]) rounds[round] = [];
        rounds[round].push({ match, tip });
      });

      const container = document.getElementById("results");

      for (const roundId of Object.keys(rounds).sort()) {
        const group = rounds[roundId];
        const roundDiv = document.createElement("div");
        roundDiv.className = "round";
        roundDiv.innerText = `Fordul√≥: ${roundId}`;
        container.appendChild(roundDiv);

        let roundPoints = 0;

        for (const { match, tip } of group) {
          const matchDiv = document.createElement("div");
          const odds = match.odds || {};
          const correct = match.outcome === tip.tip;
          const decided = !!match.result;
          const className = decided ? (correct ? "correct" : "incorrect") : "unknown";
          matchDiv.className = `match ${className}`;

          const start = match.startTime?.toDate?.() || new Date(match.startTime);
          const tipLabel = tip.tip.toUpperCase();
          const resultText = match.result ? `${match.result} (${match.outcome})` : "m√©g nincs r√∂gz√≠tve";

          const point = decided && match.outcome === tip.tip
            ? (tip.isDouble ? 2 : 1) * (odds[tip.tip] || 1)
            : 0;
          if (decided) roundPoints += point;

          matchDiv.innerHTML = `
            <div><strong>${match.homeTeam} - ${match.awayTeam}</strong></div>
            <div>D√°tum: ${start.toLocaleString()}</div>
            <div>Odds: ${odds["1"] || "‚Äì"} / ${odds["X"] || "‚Äì"} / ${odds["2"] || "‚Äì"}</div>
            <div>Eredm√©ny: ${resultText}</div>
            <div>Leadott tipped: ${tipLabel}${tip.isDouble ? " (dupla)" : ""}</div>
            <div>Pont: ${decided ? (correct ? "+" + point + " pont" : "0 pont") : "nincs eredm√©ny"}</div>
          `;
          container.appendChild(matchDiv);
        }

        const footer = document.createElement("div");
        footer.className = "footer";
        footer.innerText = `Fordul√≥ pontsz√°m: ${roundPoints} pont`;
        container.appendChild(footer);
      }
    });
  </script>
</head>
<body>
  <h1>üìã Eredm√©nyek</h1>
  <div id="results"></div>
</body>
</html>
