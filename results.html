<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Eredmények</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Eredmények</h2>
  <div id="results">Betöltés...</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore, collection, getDocs, query, where, orderBy
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC2xpMW1xgaWIdI2Jo",
      authDomain: "tippliga-2025.firebaseapp.com",
      projectId: "tippliga-2025",
      storageBucket: "tippliga-2025.appspot.com",
      messagingSenderId: "1040431900814",
      appId: "1:1040431900814:web:b307e8c2020a11d62b0573"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async user => {
      const resultsDiv = document.getElementById("results");

      if (!user) {
        window.location.href = "login.html";
        return;
      }

      console.log("Bejelentkezve:", user.email);

      try {
        const fixturesRef = collection(db, "fixtures");
        const now = new Date();

        const q = query(fixturesRef, where("startTime", "<=", now), orderBy("startTime", "desc"));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          resultsDiv.innerText = "Nincsenek megjeleníthető meccsek.";
          return;
        }

        const html = [];
        querySnapshot.forEach(doc => {
          const data = doc.data();
          const date = data.startTime?.toDate?.();
          if (!date) {
            console.warn("Hiányzó vagy hibás dátum:", data);
            return;
          }

          const home = data.homeTeam;
          const away = data.awayTeam;
          const score = data.result || "N/A";
          html.push(`<div><strong>${home} – ${away}</strong><br>Eredmény: ${score}</div><hr>`);
        });

        resultsDiv.innerHTML = html.join("");
      } catch (error) {
        console.error("Hiba az eredmények betöltésekor:", error);
        resultsDiv.innerText = "Hiba történt az eredmények betöltése közben.";
      }
    });
  </script>
</body>
</html>

